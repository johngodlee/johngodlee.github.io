<!DOCTYPE html>
<html lang="en-gb">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>An email about ordination and environmental fits | John L. Godlee</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">John L. Godlee</a></li>
      
      <li><a href="/cv">CV</a></li>
      
      <li><a href="/works">Works</a></li>
      
    </ul>
    <hr/>
    </nav>


<div>
<h1>An email about ordination and environmental fits</h1>

<h2>2020-01-15</h2>
</div>

<main>
<p>I got an email from a colleague asking for my opinion on analysing the environmental determinants of tree species diversity measured in multiple plots across a province in their country. I did a load of reading on this sort of thing about 6 months ago so I relied heavily on my notes to write a response and also provide an R script with my recommendations.</p>
<p>The original email, paraphrased slightly, said:</p>
<blockquote>
<p>Dear John</p>
<p>I need your help with diversity analysis in R for my masters student. Our goal is to detect relations between environmental variables and diversity.</p>
<p>All variables are numeric, we would like to know what kind of analysis you suggest?</p>
<p>Ordinations? Regressions? PCA? NMDS?</p>
<p>Can you guide Us?</p>
</blockquote>
<p>They also sent a document with their overall research goal:</p>
<blockquote>
<p>Evaluate and relate by statistical analysis the effect of soil, climate and topography on the spatial distribution of diversity (Richness index Shannon index and Simpson index ) of vegetation in <!-- raw HTML omitted --> province.</p>
</blockquote>
<p>y email response was:</p>
<blockquote>
<p>My preference for an ordination technique to analyse variation in species composition is NMDS. This is for two main reasons. The first is that NMDS deals well with instances where there are no shared species between two sites, which I imagine may happen a lot in your very large dataset, across a wide geographical area. Because Principle Co-ordinate Analysis (PCoA) is an eigenvalue analysis and must find a unique solution, when two or more sites share no common data, this unique solution cannot be found. The second reason is that in contrast to Principle Component Analysis (PCA), NMDS can properly represent variation in species abundances because it is not limited to using a euclidean distance method. I would recommend using the Bray-Curtis distance method.</p>
<p>I don&rsquo;t think it is wise to use all the environmental variables in the NMDS, especially because as you have shown, some of the variables are highly correlated. I think you should choose variables which you think have a valid ecological reason for influencing the species composition.</p>
<p>In addition to investigating how species composition (species identity and relative abundance) varies with environmental variables, you may wish to investigate how species diversity (species richness and abundance evenness) varies with environmental variables. To do this, I would use a simple general linear model with multiple environmental variables as the predictor variables and the Shannon index as the response variable.</p>
<p>I don&rsquo;t have your dataset so I have provided in an attached R script the way I would perform this sort of analysis in R, using an example dataset provided in the {vegan} R package which I hope is similar to your data.</p>
</blockquote>
<p>The R script I sent looked like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#8f5902;font-style:italic"># Environmental determinants of diversity </span>
<span style="color:#8f5902;font-style:italic"># John Godlee (johngodlee@gmail.com)</span>
<span style="color:#8f5902;font-style:italic"># 2020-01-12</span>

<span style="color:#8f5902;font-style:italic"># Preamble ----</span>

<span style="color:#8f5902;font-style:italic"># Set working directory</span>

<span style="color:#8f5902;font-style:italic"># Packages</span>
<span style="color:#000">library</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">vegan</span><span style="color:#000;font-weight:bold">)</span>  <span style="color:#8f5902;font-style:italic"># diversity(), metaMDS(), data(dune)</span>
<span style="color:#000">library</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ggplot2</span><span style="color:#000;font-weight:bold">)</span>  <span style="color:#8f5902;font-style:italic"># ggplot()</span>
<span style="color:#000">library</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dplyr</span><span style="color:#000;font-weight:bold">)</span>  <span style="color:#8f5902;font-style:italic"># %&gt;%, select()</span>
<span style="color:#000">library</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">tidyr</span><span style="color:#000;font-weight:bold">)</span>  <span style="color:#8f5902;font-style:italic"># gather()</span>

<span style="color:#8f5902;font-style:italic"># Import data </span>
<span style="color:#000">data</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dune</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#8f5902;font-style:italic">##&#39; Site (rows) by species (columns) abundance matrix</span>
<span style="color:#8f5902;font-style:italic">##&#39; 20 sites</span>
<span style="color:#8f5902;font-style:italic">##&#39; 30 species </span>

<span style="color:#000">env</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">read.csv</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;env.csv&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#8f5902;font-style:italic">##&#39; Dataframe with environmental variables for each of the 20 sites</span>
<span style="color:#8f5902;font-style:italic">##&#39; This is fake data I created for this example</span>

<span style="color:#8f5902;font-style:italic"># Define a function to estimate the optimal number of dimensions for an NMDS</span>
<span style="color:#000">NMDS.scree</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">function</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
  <span style="color:#000">plot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">rep</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">replicate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">metaMDS</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">autotransform</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">F</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">k</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">stress</span><span style="color:#000;font-weight:bold">),</span> 
    <span style="color:#000">xlim</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">),</span><span style="color:#000">ylim</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0.30</span><span style="color:#000;font-weight:bold">),</span> 
    <span style="color:#000">xlab</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;# of Dimensions&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">ylab</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;Stress&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">main</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;NMDS stress plot&#34;</span><span style="color:#000;font-weight:bold">)</span>
  <span style="color:#000">for </span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">i</span> <span style="color:#000">in</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000">points</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">rep</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">),</span> 
      <span style="color:#000">replicate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">metaMDS</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">autotransform</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#3465a4">F</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">k</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">stress</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000;font-weight:bold">)</span>
  <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>

<span style="color:#8f5902;font-style:italic"># Run NMDS.scree </span>
<span style="color:#000">NMDS.scree</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dune</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#8f5902;font-style:italic">##&#39; The scree plot shows that 3 dimensions produces a stress value below 0.1,</span>
<span style="color:#8f5902;font-style:italic">##&#39; which is indicates that with this many dimensions, the NMDS provides a good</span>
<span style="color:#8f5902;font-style:italic">##&#39; representation of the difference in species composition.</span>

<span style="color:#8f5902;font-style:italic"># Run NMDS with 3 dimensions</span>
<span style="color:#000">dune_nmds</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">metaMDS</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dune</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">distance</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;bray&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">try</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">500</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">trymax</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">500</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">k</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">3</span><span style="color:#000;font-weight:bold">,</span> 
  <span style="color:#000">autotransform</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">FALSE</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># Assess the fit of the NMDS with a stressplot (Shepard plot)</span>
<span style="color:#000">stressplot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dune_nmds</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#8f5902;font-style:italic">##&#39; The stressplot shows a strong positive correlation</span>
<span style="color:#8f5902;font-style:italic">##&#39; It plots the distances among objects in the ordination plot against the </span>
<span style="color:#8f5902;font-style:italic">##&#39; original Bray-Curtis distances. A tight positive correlation between </span>
<span style="color:#8f5902;font-style:italic">##&#39; original distance and transformed distance shows that the dimensionality </span>
<span style="color:#8f5902;font-style:italic">##&#39; reduction was successful.</span>

<span style="color:#8f5902;font-style:italic"># Extract final stress value of the NMDS</span>
<span style="color:#000">nmdsstress</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">dune_nmds</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">stress</span>
<span style="color:#8f5902;font-style:italic">##&#39; Should be quoted in results, to show validity of results of NMDS</span>

<span style="color:#8f5902;font-style:italic"># Extract site (plot) scores from NMDS analysis</span>
<span style="color:#000">plot_scores</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">as.data.frame</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">scores</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dune_nmds</span><span style="color:#000;font-weight:bold">))</span>  

<span style="color:#8f5902;font-style:italic"># Extract species scores from NMDS analysis</span>
<span style="color:#000">species_scores</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">as.data.frame</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">scores</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dune_nmds</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;species&#34;</span><span style="color:#000;font-weight:bold">))</span> 
<span style="color:#000">species_scores</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">species_binomial</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">rownames</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">species_scores</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># Fit environmental variables to NMDS</span>
<span style="color:#000">dune_envfit</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">envfit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dune_nmds</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">env[</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;BIO1&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;BIO12&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;BIO15&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;BIO17&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;elevation&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;sand_coarse&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">]</span><span style="color:#000;font-weight:bold">,</span> 
<span style="color:#000">permutations</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">999</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#8f5902;font-style:italic">##&#39; Note that these aren&#39;t my recommendations for the variables you should </span>
<span style="color:#8f5902;font-style:italic">##&#39; use on your data, they are just commonly used variables.</span>

<span style="color:#8f5902;font-style:italic"># Which environmental variables significantly affect species composition?</span>
<span style="color:#000">dune_envfit</span>

<span style="color:#8f5902;font-style:italic"># Create ggplot of NMDS output</span>

<span style="color:#8f5902;font-style:italic"># Get arrow vectors</span>
<span style="color:#000">dune_envfit_arrows</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">data.frame</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dune_envfit</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">vectors</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">arrows</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">dune_envfit_arrows</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">var</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">rownames</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dune_envfit_arrows</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">dune_envfit_arrows</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">r2</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">dune_envfit</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">vectors</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">r</span>
<span style="color:#000">dune_envfit_arrows</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">p</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">dune_envfit</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">vectors</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">pvals</span>

<span style="color:#000">dune_nmds_plot</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">ggplot</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
  <span style="color:#000">geom_hline</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">yintercept</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">linetype</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
  <span style="color:#000">geom_vline</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">xintercept</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">linetype</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
  <span style="color:#000">geom_point</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">species_scores</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">NMDS1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">NMDS2</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">shape</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">colour</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;black&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
  <span style="color:#000">geom_point</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">plot_scores</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">NMDS1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">NMDS2</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">shape</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">colour</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;red&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span>
  <span style="color:#000">geom_segment</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">dune_envfit_arrows</span><span style="color:#000;font-weight:bold">,</span> 
    <span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">xend</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">NMDS1</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">r2</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">yend</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">NMDS2</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">r2</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">),</span> 
    <span style="color:#000">arrow</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">arrow</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">length</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">unit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0.05</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;npc&#34;</span><span style="color:#000;font-weight:bold">)),</span>
    <span style="color:#000">colour</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;blue&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
  <span style="color:#000">geom_text</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">dune_envfit_arrows</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">NMDS1</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">r2</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">NMDS2</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">r2</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">label</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">var</span><span style="color:#000;font-weight:bold">),</span>
    <span style="color:#000">colour</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;blue&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
    <span style="color:#000">coord_equal</span><span style="color:#000;font-weight:bold">()</span>

<span style="color:#8f5902;font-style:italic"># General linear model of Shannon index vs. environment</span>

<span style="color:#8f5902;font-style:italic"># Calculate Shannon index from abundance matrix</span>
<span style="color:#000">env</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">shannon</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">diversity</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dune</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># Run linear model with multiple predictors</span>
<span style="color:#000">dune_lm</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">lm</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">shannon</span> <span style="color:#ce5c00;font-weight:bold">~</span> <span style="color:#000">BIO1</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">BIO12</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">BIO15</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">BIO17</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">elevation</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">sand_coarse</span><span style="color:#000;font-weight:bold">,</span> 
  <span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">env</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#8f5902;font-style:italic">##&#39; You may find that the model should be more complex than this, possibly with </span>
<span style="color:#8f5902;font-style:italic">##&#39; interaction terms, depending on the variables you choose. Also, you may </span>
<span style="color:#8f5902;font-style:italic">##&#39; want to introduce a spatial auto-correlation term. Finally, you should check</span>
<span style="color:#8f5902;font-style:italic">##&#39; that the predictor variables conform to the assumptions of a general </span>
<span style="color:#8f5902;font-style:italic">##&#39; linear model.</span>

<span style="color:#8f5902;font-style:italic"># Which environmental variables significantly (p&lt;0.05) affect species diversity?</span>
<span style="color:#000">summary</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dune_lm</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># Plot of linear relationship between shannon and chosen environmental variables</span>
<span style="color:#000">env_gather</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">env</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
  <span style="color:#000">dplyr</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">select</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">plotcode</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">shannon</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">BIO1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">BIO12</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">BIO15</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">BIO17</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">elevation</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">sand_coarse</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span>
  <span style="color:#000">gather</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">key</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;var&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;value&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">plotcode</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">shannon</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">dune_lm_plot</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">ggplot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">env_gather</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">value</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">shannon</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">+</span>
  <span style="color:#000">geom_point</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
  <span style="color:#000">geom_smooth</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">method</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;lm&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
  <span style="color:#000">facet_wrap</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000">var</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">scales</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;free_x&#34;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div>
</main>

  <footer>
  <hr/>
  John L. Godlee <a href="mailto:johngodlee@gmail.com">johngodlee@gmail.com</a>
  
  </footer>
  </body>
</html>

