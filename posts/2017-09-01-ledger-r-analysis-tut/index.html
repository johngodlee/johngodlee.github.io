<!DOCTYPE html>
<html lang="en-gb">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Analysing Ledger Personal Accounting Data Using R | John L. Godlee</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">John L. Godlee</a></li>
      
      <li><a href="/cv">CV</a></li>
      
      <li><a href="/works">Works</a></li>
      
    </ul>
    <hr/>
    </nav>


<div>
<h1>Analysing Ledger Personal Accounting Data Using R</h1>

<h2>2017-09-01</h2>
</div>

<main>
<p><a href="http://ledger-cli.org" target="_blank">Ledger</a>
 (aka Ledger-CLI) provides a great framework to keep track of your personal finances. Keeping your data in plain text format provides multiple benefits:</p>
<ul>
<li>You can read the file without any fancy programs, just a text editor</li>
<li>Even if Ledger stops being maintained, you can still use the journal file</li>
<li>The file can be interpreted using many other programming languages, like R!</li>
</ul>
<p>To properly visualise how my finances are changing over time however, I find the text based reports provided by ledger-cli a bit dense and fiddly.</p>
<p>This post might be an exercise in reinventing the wheel. Ledger already has a decent <a href="https://github.com/ledger/ledger-web" target="_blank">web-based reporting system</a>
 that can provide pretty graphs and lots of other ledger-like apps that can do similar. But my language of choice for making pretty graphs and manipulating data is &lsquo;R&rsquo;, so I&rsquo;m going to use that.</p>
<p>ost of the code below is actually data manipulation, which I&rsquo;ve chosen to do with the <code>dplyr</code> package, creating the plots in <code>ggplot2</code> isn&rsquo;t too taxing. I&rsquo;ve created an example script <a href="/files/ledger/ledger_journal_analysis.R">here</a>
 and you can find the example <code>.ledger.journal</code> file I used <a href="/files/ledger/example_ledger.journal">here</a>
</p>
<p>Firstly, export your ledger journal file (<code>.ledger.journal</code>) as a <code>.csv</code> in the terminal, the name and filepath of your journal file might be different:</p>
<pre tabindex="0"><code class="language-shell-script" data-lang="shell-script">touch ledger.csv

ledger csv -f ~/.ledger.journal &gt; ledger.csv
</code></pre><p>And that&rsquo;s the last thing we&rsquo;ll be doing in the shell, everything else will be in R. So fire up an R session to start analysing the data.</p>
<p>Firstly set the working directory, import the csv file and load some packages:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#8f5902;font-style:italic"># set working directory to `.ledger.journal`</span>
<span style="color:#000">setwd</span><span style="color:#000;font-weight:bold">()</span>

<span style="color:#8f5902;font-style:italic"># Create vector of column names</span>
<span style="color:#000">journal_names</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Date&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;NA_1&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;Description&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;Source&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;Currency&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;Amount&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;NA_2&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;NA_3&#34;</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># Import csv</span>
<span style="color:#000">ledger</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">read.csv</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;ledger.csv&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">col.names</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">journal_names</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># Load packages</span>
<span style="color:#000">library</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dplyr</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">library</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ggplot2</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Now to make the <code>ledger</code> dataframe easier to use:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#8f5902;font-style:italic"># Convert &#34;Date&#34; column to date class</span>
<span style="color:#000">ledger</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">Good_date</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">as.Date</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ledger</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">Date</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">format</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;%Y/%m/%d&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">class</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ledger</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">Good_date</span><span style="color:#000;font-weight:bold">)</span>  <span style="color:#8f5902;font-style:italic"># To check the above worked</span>

<span style="color:#8f5902;font-style:italic"># Sort by &#34;Good_date&#34;</span>
<span style="color:#000">ledger_sort</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">ledger</span><span style="color:#000">[order</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ledger</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">Good_date</span><span style="color:#000;font-weight:bold">),</span><span style="color:#000">]</span>

<span style="color:#8f5902;font-style:italic"># Add cumulative column for each source</span>
<span style="color:#000">ledger_cumsum</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">ledger_sort</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span>
	<span style="color:#000">group_by</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Source</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span>
	<span style="color:#000">mutate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Cumulative</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cumsum</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Amount</span><span style="color:#000;font-weight:bold">))</span>
</code></pre></div><p>The rest involves creating a few graphs that I find useful. For all these plots to work in their current form however, your <code>Source</code> or &ldquo;Account&rdquo; structure must be the similar to the recommended structure found in the <a href="http://ledger-cli.org/3.0/doc/ledger3.html#Example-Journal-File" target="_blank">ledger-cli example journal</a>
, e.g.:</p>
<pre tabindex="0"><code class="language-shell-script" data-lang="shell-script">┃
┣Assets
┃┣Checking
┃┣Savings
┃┗Cash
┣Income
┃┣Work
┃┗Ebay_sales
┗Expenses
 ┣Socialising
 ┣Bills
 ┗Mortgage
</code></pre><p>For instance if I had to pay a bill in ledger, the journal entry might look like this:</p>
<pre tabindex="0"><code class="language-shell-script" data-lang="shell-script">2017/12/06 Electricity bill
	Assets:Checking			$-65.51
	Expenses:Bills			$ 65.51
</code></pre><p>But it should be trivial to change the code to match your journal structure.</p>
<h2 id="assets-over-time">Assets over time</h2>
<p><a href="/img_full/ledger/assets_time_plot.png">&lt;img src=&#34;/img/ledger/assets_time_plot.png&#34; alt=&#34;ggplot of assets over time&#34;&gt;</a>
</p>
<p>Create a data frame only containing assets:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#000">assets</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">ledger_cumsum</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span>
	<span style="color:#000">filter</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">grepl</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Assets&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Source</span><span style="color:#000;font-weight:bold">))</span>
</code></pre></div><p>Then make the plot:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#000">ggplot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">assets</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Good_date</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Cumulative</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">group</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Source</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">+</span>
	<span style="color:#000">geom_hline</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">yintercept</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">colour</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;red&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span>
	<span style="color:#000">geom_line</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">colour</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Source</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">size</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1.2</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span>
	<span style="color:#000">geom_point</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">colour</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Source</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">size</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span>
	<span style="color:#000">scale_x_date</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">date_breaks</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;1 week&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">date_labels</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;%W/%y&#34;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h2 id="viewing-a-particular-asset-in-detail-over-time">Viewing a particular asset in detail over time</h2>
<p><a href="/img_full/ledger/single_asset_plot.png">&lt;img src=&#34;/img/ledger/single_asset_plot.png&#34; alt=&#34;Detailed view of asset with transactions&#34;&gt;</a>
</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#8f5902;font-style:italic"># Create data frame</span>
<span style="color:#000">assets_bank_current</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">ledger_cumsum</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span>
	<span style="color:#000">filter</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Source</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#34;Assets:Checking&#34;</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># Line plot of student account over time with description of expenditure</span>
<span style="color:#000">ggplot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">assets_bank_current</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Good_date</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Cumulative</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">group</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Source</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">label</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Description</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
	<span style="color:#000">geom_line</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
	<span style="color:#000">geom_text</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
	<span style="color:#000">scale_x_date</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">date_breaks</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;2 days&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">date_labels</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;%W/%y&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
	<span style="color:#000">xlab</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Date WW-YY&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
	<span style="color:#000">ylab</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Balance ($)&#34;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h2 id="bar-plots-with-breakdown-of-expenses">Bar plots with breakdown of expenses</h2>
<p><a href="/img_full/ledger/bar_expenses_plot.png">&lt;img src=&#34;/img/ledger/bar_expenses_plot.png&#34; alt=&#34;Bar plot of expenses&#34;&gt;</a>
</p>
<p><a href="/img_full/ledger/stack_expenses_plot.png">&lt;img src=&#34;/img/ledger/stack_expenses_plot.png&#34; alt=&#34;Stacked bar plot of expenses&#34;&gt;</a>
</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#8f5902;font-style:italic"># Create summary dataframe of expenses</span>
<span style="color:#000">expenses_sum</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">ledger_cumsum</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span>
	<span style="color:#000">filter</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">grepl</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Expenses&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Source</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span>
	<span style="color:#000">group_by</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Source</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span>
	<span style="color:#000">summarise</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Amount</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sum</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Amount</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span>
	<span style="color:#000">mutate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Percentage</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Amount</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#000">sum</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Amount</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#0000cf;font-weight:bold">100</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span>
	<span style="color:#000">mutate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Source</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">factor</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Source</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">levels</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Source</span><span style="color:#000">[order</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Amount</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">decreasing</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">TRUE</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">]</span><span style="color:#000;font-weight:bold">))</span>  <span style="color:#8f5902;font-style:italic"># Create ordered factor for x axis</span>

<span style="color:#8f5902;font-style:italic"># Bar plot</span>
<span style="color:#000">ggplot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">expenses_sum</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Source</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Amount</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
	<span style="color:#000">geom_bar</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">stat</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;identity&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">fill</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Source</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
	<span style="color:#000">theme</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">legend.position</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;none&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span>
	<span style="color:#000">ylab</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Amount ($)&#34;</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># Stacked percentage bar chart</span>
<span style="color:#000">ggplot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">expenses_sum</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">NA</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Percentage</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">fill</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Source</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
	<span style="color:#000">geom_bar</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">stat</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;identity&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
	<span style="color:#000">geom_text</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">label</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">paste</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">round</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Percentage</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">digits</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#4e9a06">&#34;% - &#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Source</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">sep</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">)),</span> <span style="color:#000">position</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">position_stack</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">vjust</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0.5</span><span style="color:#000;font-weight:bold">))</span>
</code></pre></div><h2 id="last-30-days-incomeexpenses-summary">Last 30 days income/expenses summary</h2>
<p><a href="/img_full/ledger/30d_summ_plot.png">&lt;img src=&#34;/img/ledger/30d_summ_plot.png&#34; alt=&#34;30 days income vs. expenses&#34;&gt;</a>
</p>
<p>Creating this plot was fun, I had a go at using <code>ifelse()</code> arguments inside the <code>ggplot()</code> call in order to change the position of an error bar and text (which I&rsquo;ve used to show deficit) depending on whether I&rsquo;ve made a net gain or loss that month.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#8f5902;font-style:italic"># Create summary dataframe</span>
<span style="color:#000">ledger_30d_summ</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">ledger_cumsum</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span>
	<span style="color:#000">filter</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Good_date</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">as.Date</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Sys.Date</span><span style="color:#000;font-weight:bold">(),</span> <span style="color:#000">format</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;%Y-%m-%d&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">30</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span>
	<span style="color:#000">filter</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">grepl</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Assets&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Source</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span>
	<span style="color:#000">mutate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">expense_income</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">if_else</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Amount</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;Income&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;Expense&#34;</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span>
	<span style="color:#000">group_by</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">expense_income</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span>
	<span style="color:#000">summarise</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Total</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sum</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Amount</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span>
	<span style="color:#000">mutate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Total</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">abs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Total</span><span style="color:#000;font-weight:bold">))</span>


<span style="color:#8f5902;font-style:italic"># Create colour palette </span>
<span style="color:#000">expense_income_palette</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;#D43131&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;#1CB5DB&#34;</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># Create plot</span>
<span style="color:#000">ggplot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ledger_30d_summ</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">expense_income</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Total</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">environment</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">environment</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
	<span style="color:#000">geom_bar</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">stat</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;identity&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">fill</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">expense_income_palette</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
	<span style="color:#000">geom_errorbar</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">ifelse</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ledger_30d_summ</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">Total[1]</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">ledger_30d_summ</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">Total[2]</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;Income&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;Expense&#34;</span><span style="color:#000;font-weight:bold">),</span> 
			<span style="color:#000">ymax</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ledger_30d_summ</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">Total</span><span style="color:#000;font-weight:bold">),</span>
			<span style="color:#000">ymin</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">min</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ledger_30d_summ</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">Total</span><span style="color:#000;font-weight:bold">)))</span> <span style="color:#ce5c00;font-weight:bold">+</span>
	<span style="color:#000">geom_text</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">ifelse</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ledger_30d_summ</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">Total[1]</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">ledger_30d_summ</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">Total[2]</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;Income&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;Expense&#34;</span><span style="color:#000;font-weight:bold">),</span>
		<span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">min</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ledger_30d_summ</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">Total</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">0.5</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ledger_30d_summ</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">Total</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">min</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ledger_30d_summ</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">Total</span><span style="color:#000;font-weight:bold">)),</span>
		<span style="color:#000">label</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">ifelse</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ledger_30d_summ</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">Total[1]</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">ledger_30d_summ</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">Total[2]</span><span style="color:#000;font-weight:bold">,</span>
		<span style="color:#000">paste</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;$ -&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ledger_30d_summ</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">Total</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">min</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ledger_30d_summ</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">Total</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">sep</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">),</span>
		<span style="color:#000">paste</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;$ &#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ledger_30d_summ</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">Total</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">min</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ledger_30d_summ</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">Total</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">sep</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">)),</span>
		<span style="color:#000">hjust</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">-0.5</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
	<span style="color:#000">xlab</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Expense/Income&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
	<span style="color:#000">ylab</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Amount ($)&#34;</span><span style="color:#000;font-weight:bold">)</span> 
</code></pre></div><p>Now that I&rsquo;ve defined all these plots, it shouldn&rsquo;t take too much effort to turn them into a basic Shiny app that I can load up in my web browser, or run a script that saves the plots as images on my computer so I can look at them later.</p>

</main>

  <footer>
  <hr/>
  John L. Godlee <a href="mailto:johngodlee@gmail.com">johngodlee@gmail.com</a>
  
  </footer>
  </body>
</html>

