<!DOCTYPE html>
<html lang="en-gb">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>John L. Godlee</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">John L. Godlee</a></li>
      
      <li><a href="/cv">CV</a></li>
      
      <li><a href="/works">Works</a></li>
      
    </ul>
    <hr/>
    </nav>


<div>
<h1>Estimating canopy rugosity from terrestrial LiDAR</h1>

<h2>2021-01-01</h2>
</div>

<main>
<p>As part of my PhD research I have been using terrestrial LiDAR to understand woodland tree canopy traits in southern African savannas. One of the measurements I wanted to make was an estimate of the roughness of the top of the canopy. I&rsquo;ve also heard this referred to as the canopy rugosity. In a previous post I&rsquo;ve already described how I processed the raw point cloud data to produce a <code>.csv</code> with XYZ point coordinates, so I&rsquo;ll skip straight to how I used R to estimate canopy rugosity.</p>
<p>After reading in the file with <code>data.table::fread()</code> the first thing was to assign each point to a 10x10cm 2D bin in the XY plane, then I took the 95th percentile, 99th percentile, and maximum point height within each bin:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#000">dat</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">fread</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># Assign each point to a 2D bin, </span>
<span style="color:#8f5902;font-style:italic"># 10x10 cm bins</span>
<span style="color:#000">dat_xy_bin</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">dat</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
<span style="color:#000">mutate</span><span style="color:#000;font-weight:bold">(</span>
  <span style="color:#000">bin_x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cut</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.$X</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">include.lowest</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">TRUE</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">labels</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">FALSE</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#000">breaks</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">seq</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">floor</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">min</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.$X</span><span style="color:#000;font-weight:bold">)),</span> <span style="color:#000">ceiling</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.$X</span><span style="color:#000;font-weight:bold">)),</span> <span style="color:#000">by</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">xy_width</span><span style="color:#000;font-weight:bold">)),</span>
  <span style="color:#000">bin_y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cut</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.$Y</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">include.lowest</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">TRUE</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">labels</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">FALSE</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#000">breaks</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">seq</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">floor</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">min</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.$Y</span><span style="color:#000;font-weight:bold">)),</span> <span style="color:#000">ceiling</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.$Y</span><span style="color:#000;font-weight:bold">)),</span> <span style="color:#000">by</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">xy_width</span><span style="color:#000;font-weight:bold">)))</span>

<span style="color:#8f5902;font-style:italic"># Quantiles of height in each bin</span>
<span style="color:#000">dat_xy_bin_summ</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">dat_xy_bin</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span>
<span style="color:#000">group_by</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">bin_x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">bin_y</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span>
<span style="color:#000">summarise</span><span style="color:#000;font-weight:bold">(</span>
  <span style="color:#000">q95</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">quantile</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Z</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0.95</span><span style="color:#000;font-weight:bold">),</span>
  <span style="color:#000">q99</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">quantile</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Z</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0.99</span><span style="color:#000;font-weight:bold">),</span>
  <span style="color:#000">max</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">Z</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">na.rm</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">TRUE</span><span style="color:#000;font-weight:bold">)</span>
  <span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Then I extracted a number of simple descriptive statistics from the distributions of values (q95, q99, max) across each XY bin:</p>
<ul>
<li>Mean</li>
<li>Median</li>
<li>Standard deviation</li>
<li>Range</li>
<li>Coefficient of variation (StDev / mean * 100)</li>
<li>Modal 10cm height bin</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#8f5902;font-style:italic"># Calculate mean, median, stdev of distribution (canopy top rugosity)</span>
<span style="color:#000">summ</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">dat_xy_bin_summ</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span>
<span style="color:#000">ungroup</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span>
<span style="color:#000">summarise</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">across</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">q95</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">q99</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">max</span><span style="color:#000;font-weight:bold">),</span> 
    <span style="color:#000">list</span><span style="color:#000;font-weight:bold">(</span>
      <span style="color:#000">max</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">na.rm</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">TRUE</span><span style="color:#000;font-weight:bold">),</span>
      <span style="color:#000">min</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000">min</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">na.rm</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">TRUE</span><span style="color:#000;font-weight:bold">),</span>
      <span style="color:#000">mean</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000">mean</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">na.rm</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">TRUE</span><span style="color:#000;font-weight:bold">),</span> 
      <span style="color:#000">median</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000">median</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">na.rm</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">TRUE</span><span style="color:#000;font-weight:bold">),</span>
      <span style="color:#000">sd</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000">sd</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">na.rm</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">TRUE</span><span style="color:#000;font-weight:bold">),</span>
      <span style="color:#000">range</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">na.rm</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">TRUE</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">min</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">na.rm</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">TRUE</span><span style="color:#000;font-weight:bold">),</span>
      <span style="color:#000">cov</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000">sd</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">na.rm</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">TRUE</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#000">mean</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">na.rm</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">TRUE</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#0000cf;font-weight:bold">100</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#000">median_max_ratio</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000">median</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">na.rm</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">TRUE</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">na.rm</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">TRUE</span><span style="color:#000;font-weight:bold">),</span>
      <span style="color:#000">mode_bin</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000">as.numeric</span><span style="color:#000;font-weight:bold">(</span>
        <span style="color:#000">gsub</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;]&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">,</span> 
          <span style="color:#000">gsub</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;.*,&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">,</span> 
            <span style="color:#000">names</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sort</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">table</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cut</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.x</span><span style="color:#000;font-weight:bold">,</span> 
                    <span style="color:#000">seq</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">floor</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">min</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.x</span><span style="color:#000;font-weight:bold">)),</span> 
                      <span style="color:#000">ceiling</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.x</span><span style="color:#000;font-weight:bold">)),</span> <span style="color:#000">by</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">xy_width</span><span style="color:#000;font-weight:bold">))),</span> 
                <span style="color:#000">decreasing</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">TRUE</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">[1]</span><span style="color:#000;font-weight:bold">))))</span>
      <span style="color:#000;font-weight:bold">)))</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span>
<span style="color:#000">gather</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
<span style="color:#000">mutate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">plot_id</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">plot_id</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span>
<span style="color:#000">dplyr</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">select</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">plot_id</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">key</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">value</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span>
<span style="color:#000">bind_rows</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.,</span> 
  <span style="color:#000">data.frame</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">plot_id</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">plot_id</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">key</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;entropy&#34;</span><span style="color:#000;font-weight:bold">,</span> 
    <span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">enl</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dat</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">Z</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">z_width</span><span style="color:#000;font-weight:bold">)))</span>
</code></pre></div><p>Finally I made a histogram of the canopy top distribution, and a surface plot of the canopy height surface:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#8f5902;font-style:italic"># Histogram of distribution</span>
<span style="color:#000">pdf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">file</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">file.path</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;../img/canopy_height_hist&#34;</span><span style="color:#000;font-weight:bold">,</span> 
  <span style="color:#000">paste0</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">plot_id</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;_canopy_height_hist.pdf&#34;</span><span style="color:#000;font-weight:bold">)),</span> <span style="color:#000">width</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">12</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">height</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">8</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">print</span><span style="color:#000;font-weight:bold">(</span>
<span style="color:#000">ggplot</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
<span style="color:#000">geom_histogram</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">dat_xy_bin_summ</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">q99</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">binwidth</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">xy_width</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#000">fill</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;grey&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">colour</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;black&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span>
<span style="color:#000">geom_vline</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">summ[summ</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">key</span> <span style="color:#ce5c00;font-weight:bold">%in%</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;q99_mode_bin&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;q99_mean&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;q99_median&#34;</span><span style="color:#000;font-weight:bold">),</span><span style="color:#000">]</span><span style="color:#000;font-weight:bold">,</span> 
  <span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">xintercept</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">value</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">colour</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">key</span><span style="color:#000;font-weight:bold">),</span> 
  <span style="color:#000">size</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1.5</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
<span style="color:#000">theme_bw</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">dev.off</span><span style="color:#000;font-weight:bold">()</span>

<span style="color:#8f5902;font-style:italic"># Surface plot of canopy height surface</span>
<span style="color:#000">pdf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">file</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">file.path</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;../img/canopy_height_surface&#34;</span><span style="color:#000;font-weight:bold">,</span> 
  <span style="color:#000">paste0</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">plot_id</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;_canopy_height_surface.pdf&#34;</span><span style="color:#000;font-weight:bold">)),</span> <span style="color:#000">width</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">12</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">height</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">12</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">print</span><span style="color:#000;font-weight:bold">(</span>
<span style="color:#000">ggplot</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
  <span style="color:#000">geom_tile</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">dat_xy_bin_summ</span><span style="color:#000;font-weight:bold">,</span> 
    <span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">bin_x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">bin_y</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">fill</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">q99</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
  <span style="color:#000">scale_fill_scico</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">palette</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;bamako&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
  <span style="color:#000">theme_bw</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
  <span style="color:#000">coord_equal</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">dev.off</span><span style="color:#000;font-weight:bold">()</span>
</code></pre></div><figure><a href="/img_full/rugosity/hist.png"><img
          alt="Canopy top 99th percentile histogram"
          title="Canopy top 99th percentile histogram"src="/img/rugosity/hist.png" 
      /></a></figure>


<figure><a href="/img_full/rugosity/surface.png"><img
          alt="Canopy top surface plot"
          title="Canopy top surface plot"src="/img/rugosity/surface.png" 
      /></a></figure>



</main>

  <footer>
  <hr/>
  John L. Godlee | 
  <a href="mailto:johngodlee@gmail.com">johngodlee@gmail.com</a> |
  <a href="http://johngodlee.xyz//index.xml">RSS</a>

  </footer>
  </body>
</html>

