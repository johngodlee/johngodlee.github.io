<!DOCTYPE html>
<html lang="en-gb">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>John L. Godlee</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">John L. Godlee</a></li>
      
      <li><a href="/files/cv/john_l_godlee_cv.pdf">CV</a></li>
      
      <li><a href="/works">Works</a></li>
      
    </ul>
    <hr/>
    </nav>


<div>
<h1>Toggle nvim-cmp keybinding</h1>

<h2>2025-07-27</h2>
</div>

<main>
<p>I use <a href=""><code>nvim-cmp</code></a>
 in neovim for auto-completion. It&rsquo;s great for programming, but if I&rsquo;m writing prose I only rarely want completion, for example if there&rsquo;s a difficult to spell species name that I want to repeat. I added to my nvim-cmp lua config a function and keybinding which toggles completion in any buffer.</p>
<p>These are the relevant bits of the config. Full config at the end:</p>
<p>This function goes in the <code>config = function()</code> part of the config, and defines the function to toggle completion in the local buffer, with a notification showing the status of the toggle. Below this is a keybinding (<code>&lt;C-k&gt;</code>) which runs the function in normal and visual modes.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">-- Define custom function to toggle cmp</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">local</span> <span style="color:#204a87;font-weight:bold">function</span> <span style="color:#000">toggle_cmp_buffer</span><span style="color:#000;font-weight:bold">()</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">local</span> <span style="color:#000">buf_enabled</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cmp.get_config</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">enabled</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">cmp.setup</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">buffer</span><span style="color:#000;font-weight:bold">({</span> <span style="color:#000">enabled</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">not</span> <span style="color:#000">buf_enabled</span> <span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">vim.notify</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;nvim-cmp &#34;</span> <span style="color:#ce5c00;font-weight:bold">..</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">not</span> <span style="color:#000">buf_enabled</span> <span style="color:#204a87;font-weight:bold">and</span> <span style="color:#4e9a06">&#34;enabled&#34;</span> <span style="color:#204a87;font-weight:bold">or</span> <span style="color:#4e9a06">&#34;disabled&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">..</span> <span style="color:#4e9a06">&#34; in buffer&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">vim.log</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">levels.INFO</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span><span style="color:#000">vim.keymap</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">set</span><span style="color:#000;font-weight:bold">({</span> <span style="color:#4e9a06">&#34;n&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;v&#34;</span> <span style="color:#000;font-weight:bold">},</span> <span style="color:#4e9a06">&#34;&lt;C-k&gt;&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">toggle_cmp_buffer</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">{</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">noremap</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">silent</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">true</span> 
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">})</span>
</span></span></code></pre></div><p>This next part goes in the <code>cmp.setup({ ... mapping = {</code> section alongside other cmp keybindings. It simply runs the function using the same keybinding as above, but in insert and select modes, since nvim-cmp is only active in these modes.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">-- Toggle cmp in insert and select modes</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;&lt;C-k&gt;&#34;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cmp.mapping</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">function</span><span style="color:#000;font-weight:bold">()</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">toggle_cmp_buffer</span><span style="color:#000;font-weight:bold">()</span> 
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">end</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">&#34;i&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;s&#34;</span> <span style="color:#000;font-weight:bold">}),</span>
</span></span></code></pre></div><p>Full nvim-cmp config:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">-- Completion</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#4e9a06">&#34;hrsh7th/nvim-cmp&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">event</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">&#34;InsertEnter&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;CmdlineEnter&#34;</span> <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">dependencies</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#4e9a06">&#34;hrsh7th/cmp-buffer&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>			<span style="color:#4e9a06">&#34;hrsh7th/cmp-path&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>			<span style="color:#4e9a06">&#34;hrsh7th/cmp-cmdline&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>				<span style="color:#4e9a06">&#34;L3MON4D3/LuaSnip&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">version</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;v2.*&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>			<span style="color:#4e9a06">&#34;saadparwaiz1/cmp_luasnip&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>			<span style="color:#4e9a06">&#34;onsails/lspkind.nvim&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>			<span style="color:#4e9a06">&#34;R-nvim/cmp-r&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">config</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">function</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>			<span style="color:#204a87;font-weight:bold">local</span> <span style="color:#000">cmp</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">require</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;cmp&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>			<span style="color:#204a87;font-weight:bold">local</span> <span style="color:#000">luasnip</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">require</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;luasnip&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>			<span style="color:#204a87;font-weight:bold">local</span> <span style="color:#000">lspkind</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">require</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;lspkind&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>			<span style="color:#8f5902;font-style:italic">-- Load SnipMate style snippets</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">require</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;luasnip.loaders.from_snipmate&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">lazy_load</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>			<span style="color:#8f5902;font-style:italic">-- Define custom function to only expand if preceded</span>
</span></span><span style="display:flex;"><span>			<span style="color:#204a87;font-weight:bold">local</span> <span style="color:#000">has_words_before</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">function</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">unpack</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">unpack</span> <span style="color:#204a87;font-weight:bold">or</span> <span style="color:#000">table.unpack</span>
</span></span><span style="display:flex;"><span>				<span style="color:#204a87;font-weight:bold">local</span> <span style="color:#000">line</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">col</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">unpack</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">vim.api</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">nvim_win_get_cursor</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>				<span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">col</span> <span style="color:#ce5c00;font-weight:bold">~=</span> <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#204a87;font-weight:bold">and</span> <span style="color:#000">vim.api</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">nvim_buf_get_lines</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">line</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">line</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">true</span><span style="color:#000;font-weight:bold">)[</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]:</span><span style="color:#000">sub</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">col</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">col</span><span style="color:#000;font-weight:bold">):</span><span style="color:#000">match</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;%s&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#204a87;font-weight:bold">nil</span>
</span></span><span style="display:flex;"><span>			<span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#8f5902;font-style:italic">-- Define custom function to toggle cmp</span>
</span></span><span style="display:flex;"><span>			<span style="color:#204a87;font-weight:bold">local</span> <span style="color:#204a87;font-weight:bold">function</span> <span style="color:#000">toggle_cmp_buffer</span><span style="color:#000;font-weight:bold">()</span> 
</span></span><span style="display:flex;"><span>				<span style="color:#204a87;font-weight:bold">local</span> <span style="color:#000">buf_enabled</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cmp.get_config</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">enabled</span> 
</span></span><span style="display:flex;"><span>				<span style="color:#000">cmp.setup</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">buffer</span><span style="color:#000;font-weight:bold">({</span> <span style="color:#000">enabled</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">not</span> <span style="color:#000">buf_enabled</span> <span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">vim.notify</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;nvim-cmp &#34;</span> <span style="color:#ce5c00;font-weight:bold">..</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">not</span> <span style="color:#000">buf_enabled</span> <span style="color:#204a87;font-weight:bold">and</span> <span style="color:#4e9a06">&#34;enabled&#34;</span> <span style="color:#204a87;font-weight:bold">or</span> <span style="color:#4e9a06">&#34;disabled&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">..</span> <span style="color:#4e9a06">&#34; in buffer&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">vim.log</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">levels.INFO</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>			<span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">vim.keymap</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">set</span><span style="color:#000;font-weight:bold">({</span> <span style="color:#4e9a06">&#34;n&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;v&#34;</span> <span style="color:#000;font-weight:bold">},</span> <span style="color:#4e9a06">&#34;&lt;C-k&gt;&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">toggle_cmp_buffer</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">{</span> 
</span></span><span style="display:flex;"><span>				<span style="color:#000">noremap</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">silent</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">true</span> 
</span></span><span style="display:flex;"><span>			<span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>			<span style="color:#000">cmp.setup</span><span style="color:#000;font-weight:bold">({</span> 
</span></span><span style="display:flex;"><span>				<span style="color:#000">completion</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>					<span style="color:#000">completeopt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;menu,menuone,preview,noselect&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">snippet</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>					<span style="color:#000">expand</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">function</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">args</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>						<span style="color:#000">luasnip.lsp_expand</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">args.body</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>					<span style="color:#204a87;font-weight:bold">end</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>				
</span></span><span style="display:flex;"><span>				<span style="color:#000">mapping</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>					<span style="color:#8f5902;font-style:italic">-- Toggle cmp in insert and select modes</span>
</span></span><span style="display:flex;"><span>					<span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;&lt;C-k&gt;&#34;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cmp.mapping</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">function</span><span style="color:#000;font-weight:bold">()</span> 
</span></span><span style="display:flex;"><span>						<span style="color:#000">toggle_cmp_buffer</span><span style="color:#000;font-weight:bold">()</span> 
</span></span><span style="display:flex;"><span>					<span style="color:#204a87;font-weight:bold">end</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">&#34;i&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;s&#34;</span> <span style="color:#000;font-weight:bold">}),</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>					<span style="color:#8f5902;font-style:italic">-- &lt;Enter&gt; will insert return unless item selected</span>
</span></span><span style="display:flex;"><span>					<span style="color:#8f5902;font-style:italic">-- Insert snippet if selected</span>
</span></span><span style="display:flex;"><span>					<span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;&lt;CR&gt;&#39;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cmp.mapping</span><span style="color:#000;font-weight:bold">({</span>
</span></span><span style="display:flex;"><span>						<span style="color:#000">i</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">function</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">fallback</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>							<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">cmp.visible</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#204a87;font-weight:bold">and</span> <span style="color:#000">cmp.get_active_entry</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>								<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">luasnip.expandable</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>									<span style="color:#000">luasnip.expand</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>								<span style="color:#204a87;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>									<span style="color:#000">cmp.confirm</span><span style="color:#000;font-weight:bold">({</span>
</span></span><span style="display:flex;"><span>										<span style="color:#000">select</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>									<span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span>								<span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>							<span style="color:#204a87;font-weight:bold">else</span> 
</span></span><span style="display:flex;"><span>								<span style="color:#000">fallback</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>							<span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>						<span style="color:#204a87;font-weight:bold">end</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>						<span style="color:#000">s</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cmp.mapping</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">confirm</span><span style="color:#000;font-weight:bold">({</span> <span style="color:#000">select</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">false</span> <span style="color:#000;font-weight:bold">}),</span>
</span></span><span style="display:flex;"><span>						<span style="color:#000">c</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cmp.mapping</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">confirm</span><span style="color:#000;font-weight:bold">({</span> 
</span></span><span style="display:flex;"><span>							<span style="color:#000">behavior</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cmp.ConfirmBehavior</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Replace</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>							<span style="color:#000">select</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>						<span style="color:#000;font-weight:bold">}),</span>
</span></span><span style="display:flex;"><span>					<span style="color:#000;font-weight:bold">}),</span>
</span></span><span style="display:flex;"><span>					
</span></span><span style="display:flex;"><span>					<span style="color:#8f5902;font-style:italic">-- &lt;Tab&gt; will select next item in list</span>
</span></span><span style="display:flex;"><span>					<span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;&lt;Tab&gt;&#34;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cmp.mapping</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">function</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">fallback</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>						<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">cmp.visible</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>							<span style="color:#000">cmp.select_next_item</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>						<span style="color:#204a87;font-weight:bold">elseif</span> <span style="color:#000">luasnip.locally_jumpable</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>							<span style="color:#000">luasnip.jump</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span> 
</span></span><span style="display:flex;"><span>						<span style="color:#204a87;font-weight:bold">elseif</span> <span style="color:#000">has_words_before</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>							<span style="color:#000">cmp.complete</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>							<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">#</span><span style="color:#000">cmp.get_entries</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>								<span style="color:#000">cmp.confirm</span><span style="color:#000;font-weight:bold">({</span> <span style="color:#000">select</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">true</span> <span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span>							<span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>						<span style="color:#204a87;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>							<span style="color:#000">fallback</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>						<span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>					<span style="color:#204a87;font-weight:bold">end</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">&#34;i&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;s&#34;</span> <span style="color:#000;font-weight:bold">}),</span>
</span></span><span style="display:flex;"><span>					
</span></span><span style="display:flex;"><span>					<span style="color:#8f5902;font-style:italic">-- &lt;Shift-Tab&gt; will select previous item in list</span>
</span></span><span style="display:flex;"><span>					<span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;&lt;S-Tab&gt;&#34;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cmp.mapping</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">function</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">fallback</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>					  <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">cmp.visible</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>						<span style="color:#000">cmp.select_prev_item</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>					  <span style="color:#204a87;font-weight:bold">elseif</span> <span style="color:#000">luasnip.locally_jumpable</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>						<span style="color:#000">luasnip.jump</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>					  <span style="color:#204a87;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>						<span style="color:#000">fallback</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>					  <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>					<span style="color:#204a87;font-weight:bold">end</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">&#34;i&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;s&#34;</span> <span style="color:#000;font-weight:bold">}),</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">sources</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cmp.config</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">sources</span><span style="color:#000;font-weight:bold">({</span>
</span></span><span style="display:flex;"><span>					<span style="color:#000;font-weight:bold">{</span> <span style="color:#000">name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;luasnip&#34;</span> <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>					<span style="color:#000;font-weight:bold">{</span> <span style="color:#000">name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;buffer&#34;</span> <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>					<span style="color:#000;font-weight:bold">{</span> <span style="color:#000">name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;path&#34;</span> <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>					<span style="color:#000;font-weight:bold">{</span> <span style="color:#000">name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;cmp_r&#34;</span> <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000;font-weight:bold">}),</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">formatting</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>					<span style="color:#000">format</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">function</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">entry</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">vim_item</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>					<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">vim.tbl_contains</span><span style="color:#000;font-weight:bold">({</span> <span style="color:#4e9a06">&#39;path&#39;</span> <span style="color:#000;font-weight:bold">},</span> <span style="color:#000">entry.source</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">name</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>						<span style="color:#204a87;font-weight:bold">local</span> <span style="color:#000">icon</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">hl_group</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">require</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;nvim-web-devicons&#39;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">get_icon</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">entry</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">get_completion_item</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">label</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>						<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">icon</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>							<span style="color:#000">vim_item.kind</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">icon</span>
</span></span><span style="display:flex;"><span>							<span style="color:#000">vim_item.kind_hl_group</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">hl_group</span>
</span></span><span style="display:flex;"><span>							<span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">vim_item</span>
</span></span><span style="display:flex;"><span>						<span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>					<span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>					<span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">require</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;lspkind&#39;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">cmp_format</span><span style="color:#000;font-weight:bold">({</span> <span style="color:#000">with_text</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">true</span> <span style="color:#000;font-weight:bold">})(</span><span style="color:#000">entry</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">vim_item</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>					<span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>			<span style="color:#8f5902;font-style:italic">-- Use buffer source for `/` and `?` </span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">cmp.setup</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">cmdline</span><span style="color:#000;font-weight:bold">({</span> <span style="color:#4e9a06">&#39;/&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#39;?&#39;</span> <span style="color:#000;font-weight:bold">},</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">mapping</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cmp.mapping</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">preset.cmdline</span><span style="color:#000;font-weight:bold">(),</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">sources</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>					<span style="color:#000;font-weight:bold">{</span> <span style="color:#000">name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;buffer&#39;</span> <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>			<span style="color:#8f5902;font-style:italic">-- Use cmdline &amp; path source for &#39;:&#39;</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">cmp.setup</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">cmdline</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;:&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">mapping</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cmp.mapping</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">preset.cmdline</span><span style="color:#000;font-weight:bold">(),</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">sources</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cmp.config</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">sources</span><span style="color:#000;font-weight:bold">({</span>
</span></span><span style="display:flex;"><span>					<span style="color:#000;font-weight:bold">{</span> <span style="color:#000">name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;path&#39;</span> <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000;font-weight:bold">},</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>					<span style="color:#000;font-weight:bold">{</span> <span style="color:#000">name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;cmdline&#39;</span> <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000;font-weight:bold">}),</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">matching</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">disallow_symbol_nonprefix_matching</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">false</span> <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span>		<span style="color:#204a87;font-weight:bold">end</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div>
</main>

  <footer>
  <hr/>
  John L. Godlee | 
  <a href="mailto:johngodlee@gmail.com">johngodlee@gmail.com</a> |
  <a href="http://johngodlee.xyz//index.xml">RSS</a>

  </footer>
  </body>
</html>

