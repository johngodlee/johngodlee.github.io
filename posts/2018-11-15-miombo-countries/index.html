<!DOCTYPE html>
<html lang="en-gb">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>John L. Godlee</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">John L. Godlee</a></li>
      
      <li><a href="/cv">CV</a></li>
      
      <li><a href="/works">Works</a></li>
      
    </ul>
    <hr/>
    </nav>


<div>
<h1>How much miombo is in each country</h1>

<h2>2018-11-15</h2>
</div>

<main>
<p>For some quick and dirty statistics to quote in the introduction to a report, I wanted to know how much of the miombo biome (as defined by White&rsquo;s vegetation map) was in Angola. Afterwards, I decided to try and apply the same methods to all the countries in southern Africa. I used R to do the analyses.</p>
<p>First, load some packages:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#000">library</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">rgdal</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">library</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">rgeos</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Next, import data on <a href="http://omap.africanmarineatlas.org/BIOSPHERE/pages/3_terrestrial%20vegetation.htm" target="_blank">White&amp;rsquo;s veg map</a>
 and <a href="http://maplibrary.org/library/stacks/Africa/index.htm" target="_blank">African countries</a>
.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#000">white_veg</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">readOGR</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dsn</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;whitesveg&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">layer</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;Whites vegetation&#34;</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">countries</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">readOGR</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dsn</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;africa&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">layer</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;Africa&#34;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>The Coordinate reference system (CRS) isn&rsquo;t explicitly defined in either of the spatial objects, but it&rsquo;s a good guess that they will be WGS84 long-lat, so let&rsquo;s add that.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#000">proj4string</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">white_veg</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">CRS</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;+proj=longlat +ellps=WGS84 +datum=WGS84&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">proj4string</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">countries</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">CRS</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;+proj=longlat +ellps=WGS84 +datum=WGS84&#34;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>I&rsquo;m not interested in the other biomes defined in White&rsquo;s veg. map, only those that make up the &ldquo;miombo&rdquo;. I use the miombo definition used in <a href="http://rstb.royalsocietypublishing.org/content/royptb/371/1703/20150312.full.pdf" target="_blank">Ryan et al. (2016)</a>
.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#000">miombo</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">white_veg</span><span style="color:#000">[which</span><span style="color:#000;font-weight:bold">(</span>
    <span style="color:#000;font-weight:bold">(</span><span style="color:#000">white_veg</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">DESCRIPTIO</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#34;Moist-infertile savanna&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">|</span>
    <span style="color:#000;font-weight:bold">(</span><span style="color:#000">white_veg</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">DESCRIPTIO</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#34;Mosaics of forest&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">|</span>
    <span style="color:#000;font-weight:bold">(</span><span style="color:#000">white_veg</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">DESCRIPTIO</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#34;Mopane savanna&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">|</span>
    <span style="color:#000;font-weight:bold">(</span><span style="color:#000">white_veg</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">DESCRIPTIO</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#34;Montane Forest&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">|</span>
    <span style="color:#000;font-weight:bold">(</span><span style="color:#000">white_veg</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">DESCRIPTIO</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#34;Hydropmorphic grassland&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">|</span>
    <span style="color:#000;font-weight:bold">(</span><span style="color:#000">white_veg</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">DESCRIPTIO</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#34;Arid-fertile savanna&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">|</span>
    <span style="color:#000;font-weight:bold">(</span><span style="color:#000">white_veg</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">DESCRIPTIO</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#34;Sedge and reed swamp&#34;</span><span style="color:#000;font-weight:bold">)),</span><span style="color:#000">]</span>
</code></pre></div><p>Then, I only want to keep countries that contain miombo, which I can do using <code>gIntersects()</code> from <em>rgeos</em>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#000">country_list</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">split</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">countries</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">countries</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">COUNTRY</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">intersections</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">lapply</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">country_list</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#000">function</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">)</span>
        <span style="color:#000">as.vector</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">unlist</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">gIntersects</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">miombo</span><span style="color:#000;font-weight:bold">))))</span>

<span style="color:#000">country_list_miombo</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">country_list[intersections</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#204a87;font-weight:bold">TRUE</span><span style="color:#000">]</span>
</code></pre></div><p>Then, I define a function to find UTM zones, because countries vary in their UTM zone, so I can&rsquo;t just use a flat value. Converting from lat-long to UTM is necessary so I can get km^2 area estimates, rather than square degrees. The function takes any spatial object and uses the bounding box to estimate the UTM zone.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#8f5902;font-style:italic"># Define a function to find the UTM zone</span>
<span style="color:#000">utm.zone</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">function</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">){</span>
    <span style="color:#000">num</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">floor</span><span style="color:#000;font-weight:bold">(((</span><span style="color:#000">mean</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#000">bbox[1</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">]</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">180</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span>
	<span style="color:#000">let</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">ifelse</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">mean</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">@</span><span style="color:#000">bbox[2</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">]</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;N&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;S&#34;</span><span style="color:#000;font-weight:bold">)</span>

	<span style="color:#000">return</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">paste0</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">num</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">let</span><span style="color:#000;font-weight:bold">))</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>Then, time for a big lengthy, possibly overly messy function to return a list of miombo area stats for each country.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#000">miombo.country.perc</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">function</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">country</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">miombo</span><span style="color:#000;font-weight:bold">){</span>
	<span style="color:#000">country_fix</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">gBuffer</span><span style="color:#000;font-weight:bold">(</span>
		<span style="color:#000">country</span><span style="color:#000;font-weight:bold">,</span>
		<span style="color:#000">byid</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">TRUE</span><span style="color:#000;font-weight:bold">,</span>
		<span style="color:#000">width</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>

	<span style="color:#000">miombo_country</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">gIntersection</span><span style="color:#000;font-weight:bold">(</span>
		<span style="color:#000">country_fix</span><span style="color:#000;font-weight:bold">,</span>
		<span style="color:#000">miombo</span><span style="color:#000;font-weight:bold">,</span>
		<span style="color:#000">byid</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">TRUE</span><span style="color:#000;font-weight:bold">,</span>
		<span style="color:#000">drop_lower_td</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">TRUE</span><span style="color:#000;font-weight:bold">)</span>

	<span style="color:#000">miombo_utm</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">spTransform</span><span style="color:#000;font-weight:bold">(</span>
		<span style="color:#000">miombo</span><span style="color:#000;font-weight:bold">,</span>
		<span style="color:#000">CRS</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">paste0</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;+proj=utm +zone=&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">utm.zone</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">miombo</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#4e9a06">&#34; ellps=WGS84&#34;</span><span style="color:#000;font-weight:bold">)))</span>

	<span style="color:#000">miombo_country_utm</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">spTransform</span><span style="color:#000;font-weight:bold">(</span>
		<span style="color:#000">miombo_country</span><span style="color:#000;font-weight:bold">,</span>
		<span style="color:#000">CRS</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">paste0</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;+proj=utm +zone=&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">utm.zone</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">miombo_country</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#4e9a06">&#34; ellps=WGS84&#34;</span><span style="color:#000;font-weight:bold">)))</span>

	<span style="color:#000">country_utm</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">spTransform</span><span style="color:#000;font-weight:bold">(</span>
		<span style="color:#000">country_fix</span><span style="color:#000;font-weight:bold">,</span>
		<span style="color:#000">CRS</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">paste0</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;+proj=utm +zone=&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">utm.zone</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">country_fix</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#4e9a06">&#34; ellps=WGS84&#34;</span><span style="color:#000;font-weight:bold">)))</span>

	<span style="color:#000">area_miombo_km2</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">gArea</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">miombo_utm</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#0000cf;font-weight:bold">1e6</span>

	<span style="color:#000">area_miombo_country_km2</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">gArea</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">miombo_country_utm</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#0000cf;font-weight:bold">1e6</span>

	<span style="color:#000">area_country_km2</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">gArea</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">country_utm</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#0000cf;font-weight:bold">1e6</span>

	<span style="color:#000">perc_miombo_country</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">area_miombo_country_km2</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#000">area_country_km2</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#0000cf;font-weight:bold">100</span>

	<span style="color:#000">perc_miombo_all</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">area_miombo_country_km2</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#000">area_miombo_km2</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#0000cf;font-weight:bold">100</span>

	<span style="color:#000">return</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data.frame</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">area_miombo_country_km2</span><span style="color:#000;font-weight:bold">,</span>
		<span style="color:#000">area_country_km2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">perc_miombo_country</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">perc_miombo_all</span><span style="color:#000;font-weight:bold">))</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>Then I need to run the function on each country in the list of countries, using <code>lapply()</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#000">country_miombo_stats</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">lapply</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">country_list_miombo</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">miombo.country.perc</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">miombo</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">miombo</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>And finally there is a bit of cleaning up to get a tidy data frame.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#8f5902;font-style:italic"># Collapse the resulting list</span>
<span style="color:#000">country_miombo_stats</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">do.call</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;rbind&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">country_miombo_stats</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># Add country as column</span>
<span style="color:#000">country_miombo_stats</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">country</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">rownames</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">country_miombo_stats</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>I could probably spend more time to just have the function and lapply call give me the tidy dataframe straight off, but I don&rsquo;t have the inclination.</p>
<p>I think the most useful thing to come out of this little exercise is actually the UTM zone function, I think it&rsquo;s pretty neat.</p>

</main>

  <footer>
  <hr/>
  John L. Godlee | 
  <a href="mailto:johngodlee@gmail.com">johngodlee@gmail.com</a> |
  <a href="http://johngodlee.xyz//index.xml">RSS</a>

  </footer>
  </body>
</html>

