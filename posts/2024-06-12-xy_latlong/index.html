<!DOCTYPE html>
<html lang="en-gb">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>John L. Godlee</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">John L. Godlee</a></li>
      
      <li><a href="/files/cv/john_l_godlee_cv.pdf">CV</a></li>
      
      <li><a href="/works">Works</a></li>
      
    </ul>
    <hr/>
    </nav>


<div>
<h1>Converting stem locations from lat-long to XY coordinates</h1>

<h2>2024-06-12</h2>
</div>

<main>
<p>In 2018 I wrote some code to convert stem locations within square plots from lat-long coordinates into XY grid coordinates. Recently I was asked to do the opposite, to convert XY grid coordinates into lat-long coordinates, so a colleague could combine multiple adjacent plots into one larger plot with a shared coordinate system. I&rsquo;ve pasted the code for this procedure below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Convert XY grid coordinates to Lat-long coordinates</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># John L. Godlee (johngodlee@gmail.com)</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Last updated: 2024-06-12</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Packages</span>
</span></span><span style="display:flex;"><span><span style="color:#000">library</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dplyr</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">library</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sf</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">library</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">NISTunits</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">library</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">geosphere</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">library</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ggplot2</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Define functions</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#&#39; Get valid UTM zone from latitude and longitude in WGS84 decimal degrees</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#&#39; @param x vector of longitude coordinates in decimal degrees</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#&#39; @param y vector of latitude coordinate in decimal degrees</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#&#39; @return Vector of UTM zones for each latitude-longitude pair</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#&#39; </span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#&#39; @export</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#&#39; </span>
</span></span><span style="display:flex;"><span><span style="color:#000">latLong2UTM</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">function</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">unlist</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">lapply</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#000">length</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">function</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">z</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">paste</span><span style="color:#000;font-weight:bold">((</span><span style="color:#000">floor</span><span style="color:#000;font-weight:bold">((</span><span style="color:#000">as.numeric</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x[z]</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">180</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#0000cf;font-weight:bold">6</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%%</span> <span style="color:#0000cf;font-weight:bold">60</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">ifelse</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">as.numeric</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">y[z]</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;S&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;N&#34;</span><span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">sep</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">}))</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#&#39; Generate a valid UTM WGS84 proj4string given a UTM zone</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#&#39; @param x character vector defining UTM zones</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#&#39; @return UTM proj4string character vector</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#&#39; </span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#&#39; @export</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#&#39; </span>
</span></span><span style="display:flex;"><span><span style="color:#000">UTMProj4</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">function</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">unlist</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">lapply</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#000">length</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">function</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">y</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">paste0</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34;+proj=utm +zone=&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">gsub</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;[A-z]&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">as.character</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x[y]</span><span style="color:#000;font-weight:bold">)),</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">ifelse</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">gsub</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;[0-9]&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">as.character</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x[y]</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#34;S&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34; +south&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>      <span style="color:#4e9a06">&#34; +ellps=WGS84&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">}))</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#&#39; Perform a rotation on an sf object</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#&#39; @param a angle to rotate, in radians</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#&#39; @keywords internal</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#&#39; @noRd</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#&#39; </span>
</span></span><span style="display:flex;"><span><span style="color:#000">rot</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">function</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">matrix</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cos</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">sin</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">sin</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">cos</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">a</span><span style="color:#000;font-weight:bold">)),</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000;font-weight:bold">)</span> 
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Define UTM zone for test polygon location</span>
</span></span><span style="display:flex;"><span><span style="color:#000">utm_crs</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#4e9a06">&#34;+proj=utm +zone=33 +south +ellps=WGS84&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Define origin corner (SW) of test polygon</span>
</span></span><span style="display:flex;"><span><span style="color:#000">orig</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">479000</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">8319000</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Create dataframe of polygon corners (100x100 m)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">poly_df</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">data.frame</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">longitude</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">orig[1]</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">orig[1]</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">orig[1]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">100</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">orig[1]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">100</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">orig[1]</span><span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">latitude</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">orig[2]</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">orig[2]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">100</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">orig[2]</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">100</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">orig[2]</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">orig[2]</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Convert dataframe of corners to a polygon</span>
</span></span><span style="display:flex;"><span><span style="color:#000">poly_ex</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">st_convex_hull</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">summarise</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">st_as_sf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">poly_df</span><span style="color:#000;font-weight:bold">,</span> 
</span></span><span style="display:flex;"><span>      <span style="color:#000">coords</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;longitude&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;latitude&#34;</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">crs</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">utm_crs</span><span style="color:#000;font-weight:bold">)))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Get the centroid of the polygon and rotate a bit</span>
</span></span><span style="display:flex;"><span><span style="color:#000">poly_ex_cent</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">st_centroid</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">st_geometry</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">poly_ex</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">rot_ex</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">sample</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">seq</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">360</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">poly_ex_rot</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">st_sf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">geometry</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">st_geometry</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">poly_ex</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">poly_ex_cent</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">*</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">rot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">NISTdegTOradian</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">rot_ex</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">poly_ex_cent</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">st_crs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">poly_ex_rot</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">utm_crs</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Transform rotated polygon to UTM</span>
</span></span><span style="display:flex;"><span><span style="color:#000">poly_ex_wgs</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">st_transform</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">poly_ex_rot</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">4326</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">poly_ex_wgs</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">plot_id</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#4e9a06">&#34;A&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Sample points within the rotated polygon</span>
</span></span><span style="display:flex;"><span><span style="color:#000">xy_range</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">seq</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">100</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0.5</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">s_ex</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">data.frame</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">plot_id</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;A&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">x_grid</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sample</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">xy_range</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">50</span><span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">y_grid</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sample</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">xy_range</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">50</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Rename polygon and stem data to test code below.</span>
</span></span><span style="display:flex;"><span><span style="color:#000">poly_data</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">poly_ex_wgs</span>
</span></span><span style="display:flex;"><span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">s_ex</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Add ID column</span>
</span></span><span style="display:flex;"><span><span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">id</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">seq_len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">nrow</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Get UTM zone of polygon centroid</span>
</span></span><span style="display:flex;"><span><span style="color:#000">poly_cent</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">st_coordinates</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">st_centroid</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">poly_data</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span><span style="color:#000">utm_string</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">UTMProj4</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">latLong2UTM</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">poly_cent[1]</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">poly_cent[2]</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Convert polygon to UTM</span>
</span></span><span style="display:flex;"><span><span style="color:#000">poly_utm</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">st_transform</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">poly_data</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">utm_string</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Convert UTM polygon to points</span>
</span></span><span style="display:flex;"><span><span style="color:#000">points_utm</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">st_cast</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">poly_utm</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;POINT&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">warn</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">FALSE</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">[1</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Extract coordinates as dataframe</span>
</span></span><span style="display:flex;"><span><span style="color:#000">coords_utm</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">as.data.frame</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">st_coordinates</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">points_utm</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">[1</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">2</span><span style="color:#000">]</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Define points to match corners to</span>
</span></span><span style="display:flex;"><span><span style="color:#000">match_point</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">st_sfc</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">st_point</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">mean</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">coords_utm</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">X</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1000</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">mean</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">coords_utm</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">Y</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1000</span><span style="color:#000;font-weight:bold">)))</span>
</span></span><span style="display:flex;"><span><span style="color:#000">other_point</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">st_sfc</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">st_point</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">mean</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">coords_utm</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">X</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1000</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">mean</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">coords_utm</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">Y</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1000</span><span style="color:#000;font-weight:bold">)))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Set CRS</span>
</span></span><span style="display:flex;"><span><span style="color:#000">st_crs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">other_point</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">utm_string</span>
</span></span><span style="display:flex;"><span><span style="color:#000">st_crs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">match_point</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">utm_string</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Get sw and se corner</span>
</span></span><span style="display:flex;"><span><span style="color:#000">sw_corner</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">points_utm</span><span style="color:#000">[st_nearest_feature</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">match_point</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">points_utm</span><span style="color:#000;font-weight:bold">),</span><span style="color:#000">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">se_corner</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">points_utm</span><span style="color:#000">[st_nearest_feature</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">other_point</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">points_utm</span><span style="color:#000;font-weight:bold">),</span><span style="color:#000">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Convert to WGS for geosphere compatibility</span>
</span></span><span style="display:flex;"><span><span style="color:#000">sw_wgs</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">st_coordinates</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">st_transform</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sw_corner</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">4326</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span><span style="color:#000">se_wgs</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">st_coordinates</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">st_transform</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">se_corner</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">4326</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Find rotation along SW,SE edge</span>
</span></span><span style="display:flex;"><span><span style="color:#000">xy_bearing</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">bearing</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sw_wgs</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">se_wgs</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Get centroid of polygon in UTM</span>
</span></span><span style="display:flex;"><span><span style="color:#000">cent</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">suppressWarnings</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">st_centroid</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">st_geometry</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">poly_utm</span><span style="color:#000;font-weight:bold">)))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Get location of sw corner</span>
</span></span><span style="display:flex;"><span><span style="color:#000">sw_cent</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">st_geometry</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sw_corner</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Convert angle to radians for rotation</span>
</span></span><span style="display:flex;"><span><span style="color:#000">angle</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">NISTdegTOradian</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">90</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">xy_bearing</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Rotate polygon so SW-SE is flat</span>
</span></span><span style="display:flex;"><span><span style="color:#000">poly_rot</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">st_geometry</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">poly_utm</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">cent</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">rot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">angle</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">cent</span>
</span></span><span style="display:flex;"><span><span style="color:#000">st_crs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">poly_rot</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">st_crs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">poly_utm</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Add SW UTM X and Y to XY grid coordinates</span>
</span></span><span style="display:flex;"><span><span style="color:#000">points_rot</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">st_cast</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">poly_rot</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;POINT&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">warn</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">FALSE</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">[1</span><span style="color:#ce5c00;font-weight:bold">:</span><span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">sw_corner_rot</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">points_rot</span><span style="color:#000">[st_nearest_feature</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">match_point</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">points_rot</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">se_corner_rot</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">points_rot</span><span style="color:#000">[st_nearest_feature</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">other_point</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">points_rot</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">x_grid_utm</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">x_grid</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">st_coordinates</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sw_corner_rot</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">[1]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">y_grid_utm</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">y_grid</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">st_coordinates</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sw_corner_rot</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">[2]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">x_sf</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">st_as_sf</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">x[</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;id&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;x_grid_utm&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;y_grid_utm&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">]</span><span style="color:#000;font-weight:bold">,</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">coords</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;x_grid_utm&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;y_grid_utm&#34;</span><span style="color:#000;font-weight:bold">),</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">na.fail</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">FALSE</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">crs</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">st_crs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">poly_rot</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Rotate coordinates back</span>
</span></span><span style="display:flex;"><span><span style="color:#000">x_sf_rot</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">st_geometry</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x_sf</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">cent</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">rot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">angle</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">cent</span>
</span></span><span style="display:flex;"><span><span style="color:#000">st_crs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x_sf_rot</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">st_crs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x_sf</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Transform stems to WGS84</span>
</span></span><span style="display:flex;"><span><span style="color:#000">x_wgs</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">st_transform</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x_sf_rot</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">4326</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">x_out</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">as.data.frame</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cbind</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">id</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">st_coordinates</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x_wgs</span><span style="color:#000;font-weight:bold">)))</span>
</span></span><span style="display:flex;"><span><span style="color:#000">names</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x_out</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;id&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;longitude&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;latitude&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Clean dataframe</span>
</span></span><span style="display:flex;"><span><span style="color:#000">out</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">x_out</span><span style="color:#000">[order</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x_out</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">id</span><span style="color:#000;font-weight:bold">),</span><span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;longitude&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;latitude&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">out</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">id</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#204a87;font-weight:bold">NULL</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Create plot to illustrate code above</span>
</span></span><span style="display:flex;"><span><span style="color:#000">ggplot</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span> <span style="color:#000">geom_sf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">poly_utm</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span> <span style="color:#000">geom_sf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sw_corner</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">colour</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;red&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span> <span style="color:#000">geom_sf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">se_corner</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">colour</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;blue&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span> <span style="color:#000">geom_sf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cent</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">colour</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;cyan&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span> <span style="color:#000">geom_sf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">poly_rot</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">colour</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;green&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">fill</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">NA</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span> <span style="color:#000">geom_sf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">x_sf</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span> <span style="color:#000">geom_sf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">x_sf_rot</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">colour</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;pink&#34;</span><span style="color:#000;font-weight:bold">)</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># This dataframe contains lat-long coordinates for each row of x</span>
</span></span><span style="display:flex;"><span><span style="color:#000">out</span>
</span></span></code></pre></div><figure><a href="/img_full/xy_latlong/xy_illus.png"><img
          alt="Demonstration of the code to converrt lat-long coordinates to XY coordinates."
          title="Demonstration of the code to converrt lat-long coordinates to XY coordinates."src="/img/xy_latlong/xy_illus.png" 
      /></a></figure>



</main>

  <footer>
  <hr/>
  John L. Godlee | 
  <a href="mailto:johngodlee@gmail.com">johngodlee@gmail.com</a> |
  <a href="http://johngodlee.xyz//index.xml">RSS</a>

  </footer>
  </body>
</html>

