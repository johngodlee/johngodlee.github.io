<!DOCTYPE html>
<html lang="en-gb">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>John L. Godlee</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">John L. Godlee</a></li>
      
      <li><a href="/files/cv/john_l_godlee_cv.pdf">CV</a></li>
      
      <li><a href="/works">Works</a></li>
      
    </ul>
    <hr/>
    </nav>


<div>
<h1>Processing bike ride data from Fitotrack Android app</h1>

<h2>2024-06-19</h2>
</div>

<main>
<p>I have been using The <a href="https://github.com/russok/FitoTrack" target="_blank">Fitotrack Android app</a>
 for a over a year now to track my bike rides. Fitotrack allows you to export the tracking data in XML format. I wrote an R script to process the XML data and create some basic summary plots. I have broken down the R script below:</p>
<p>Firstly, load necessary packages and import the compressed XML file, which has the file extension <code>.ftb</code>. I use <a href="https://syncthing.net/" target="_blank">Syncthing</a>
 to sync the backup files from my phone to my laptop.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Process data from FitoTrack Android app</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># John L. Godlee (johngodlee@gmail.com)</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Last updated: 2024-06-19</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Packages</span>
</span></span><span style="display:flex;"><span><span style="color:#000">library</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dplyr</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">library</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">XML</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">library</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">lubridate</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">library</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ggplot2</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">library</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">patchwork</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">library</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">archive</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">library</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">leaflet</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">library</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sf</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Find all fitotrack backups</span>
</span></span><span style="display:flex;"><span><span style="color:#000">f</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">list.files</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;~/syncthing/fitotrack&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;*.ftb&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">full.names</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">TRUE</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Check files found</span>
</span></span><span style="display:flex;"><span><span style="color:#000">stopifnot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">length</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>Then parse the file and extract each ride, represented by child nodes in the <code>workouts</code> part of the XML.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 7z unarchive the file</span>
</span></span><span style="display:flex;"><span><span style="color:#000">conn</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">archive_read</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sort</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">f</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">[1]</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Import data</span>
</span></span><span style="display:flex;"><span><span style="color:#000">dat</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">xmlParse</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">readLines</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">conn</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Separate nodes with summary data</span>
</span></span><span style="display:flex;"><span><span style="color:#000">summ_nodes</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">getNodeSet</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dat</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;//workouts//workouts&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>Summarise each node and create a pretty dataframe, where each row is a ride.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># For each node, get children as list</span>
</span></span><span style="display:flex;"><span><span style="color:#000">summ_df</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">bind_rows</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">lapply</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">seq_len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">xmlSize</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">summ_nodes</span><span style="color:#000;font-weight:bold">)),</span> <span style="color:#204a87;font-weight:bold">function</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">as.list</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">getChildrenStrings</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">summ_nodes[[x]]</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}))</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">mutate</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">across</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">all_of</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;calorie&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;ascent&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;descent&#34;</span><span style="color:#000;font-weight:bold">,</span> 
</span></span><span style="display:flex;"><span>          <span style="color:#4e9a06">&#34;avgPace&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;avgSpeed&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;topSpeed&#34;</span><span style="color:#000;font-weight:bold">,</span> 
</span></span><span style="display:flex;"><span>          <span style="color:#4e9a06">&#34;length&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;maxElevationMSL&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;minElevationMSL&#34;</span><span style="color:#000;font-weight:bold">)),</span> <span style="color:#000">as.numeric</span><span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">start</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">as_datetime</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">as.numeric</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">start</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#0000cf;font-weight:bold">1000</span><span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">end</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">as_datetime</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">as.numeric</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">end</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#0000cf;font-weight:bold">1000</span><span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">duration</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">round</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">as.period</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">end</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">start</span><span style="color:#000;font-weight:bold">)),</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">pauseDuration</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">round</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">seconds_to_period</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">as.numeric</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">pauseDuration</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#0000cf;font-weight:bold">1000</span><span style="color:#000;font-weight:bold">)))</span>
</span></span></code></pre></div><p>Create plots with summary information for each ride (<code>plots_all</code>), and a table with the same information (<code>month_summ</code>).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Define conversion factor km to miles</span>
</span></span><span style="display:flex;"><span><span style="color:#000">kmt</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#0000cf;font-weight:bold">0.6213711922</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Plot average speed of all rides over time</span>
</span></span><span style="display:flex;"><span><span style="color:#000">avgSpeed_ts</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">ggplot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">summ_df</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">start</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">avgSpeed</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">geom_point</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">shape</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">21</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">theme_bw</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">scale_y_continuous</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">expression</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Average speed&#34;</span><span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">km</span><span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000">h^</span><span style="color:#0000cf;font-weight:bold">-1</span><span style="color:#000;font-weight:bold">)),</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">sec.axis</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sec_axis</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">transform</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000">.*kmt</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">expression</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Average speed&#34;</span><span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">miles</span><span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000">h^</span><span style="color:#0000cf;font-weight:bold">-1</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">xlab</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Date&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Plot top speed of all rides over time</span>
</span></span><span style="display:flex;"><span><span style="color:#000">topSpeed_ts</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">ggplot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">summ_df</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">start</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">topSpeed</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">geom_point</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">shape</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">21</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">theme_bw</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">scale_y_continuous</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">expression</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Top speed&#34;</span><span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">km</span><span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000">h^</span><span style="color:#0000cf;font-weight:bold">-1</span><span style="color:#000;font-weight:bold">)),</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">sec.axis</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sec_axis</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">transform</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000">.*kmt</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">expression</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Top speed&#34;</span><span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">miles</span><span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000">h^</span><span style="color:#0000cf;font-weight:bold">-1</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">xlab</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Date&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Plot length of all rides over time</span>
</span></span><span style="display:flex;"><span><span style="color:#000">length_ts</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">summ_df</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">mutate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">length_km</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">length</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#0000cf;font-weight:bold">1000</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">ggplot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.,</span> <span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">start</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">length_km</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">geom_point</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">shape</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">21</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">theme_bw</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">scale_y_continuous</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;Distance (km)&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">sec.axis</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sec_axis</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">transform</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000">.*kmt</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;Distance (miles)&#34;</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">xlab</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Date&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Monthly breakdown of:</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># total distance</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># average speed</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># top speed</span>
</span></span><span style="display:flex;"><span><span style="color:#000">month_summ</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">summ_df</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">mutate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">month_year</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">format</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">as.Date</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">start</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#4e9a06">&#34;%Y-%m&#34;</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">group_by</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">month_year</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">summarise</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">total_dist</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sum</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">length</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">na.rm</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">TRUE</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#0000cf;font-weight:bold">1000</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">mean_speed</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mean</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">avgSpeed</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">na.rm</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">TRUE</span><span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">max_speed</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">topSpeed</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">na.rm</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">TRUE</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">mutate</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">total_dist_miles</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">total_dist</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">kmt</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">mean_speed_mph</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mean_speed</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">kmt</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">max_speed_mph</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">max_speed</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">kmt</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Plot monthly total distance bar chart</span>
</span></span><span style="display:flex;"><span><span style="color:#000">month_dist</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">month_summ</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">mutate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">month_year_date</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">as.Date</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">paste0</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">month_year</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;-01&#34;</span><span style="color:#000;font-weight:bold">)))</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">ggplot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.,</span> <span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">month_year_date</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">total_dist</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">geom_bar</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">stat</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;identity&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">colour</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;black&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">fill</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;grey&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">theme_bw</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">scale_x_date</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">breaks</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">seq</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">as.Date</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">paste0</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">min</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">month_summ</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">month_year</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#4e9a06">&#34;-01&#34;</span><span style="color:#000;font-weight:bold">)),</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#000">as.Date</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">paste0</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">month_summ</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">month_year</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#4e9a06">&#34;-01&#34;</span><span style="color:#000;font-weight:bold">)),</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">by</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;month&#34;</span><span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">date_labels</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;%b %Y&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">scale_y_continuous</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;Total distance (km)&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">sec.axis</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sec_axis</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">transform</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000">.*kmt</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;Total distance (miles)&#34;</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">xlab</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Month&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Patchwork plots together</span>
</span></span><span style="display:flex;"><span><span style="color:#000">plots_all</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">avgSpeed_ts</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">topSpeed_ts</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">length_ts</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">month_dist</span>
</span></span></code></pre></div><figure><a href="/img_full/fitotrack/plots_all.png"><img
          alt="Summary plots created by code above."
          title="Summary plots created by code above."src="/img/fitotrack/plots_all.png" 
      /></a></figure>


<figure><a href="/img_full/fitotrack/month_summ.png"><img
          alt="Monthly summary table cretaed by code above."
          title="Monthly summary table cretaed by code above."src="/img/fitotrack/month_summ.png" 
      /></a></figure>


<p>Now to process the data from a single ride. Fitotrack splits each ride up into interals which share a single ID, within the <code>samples</code> part of the XML.</p>
<p>First process each node and create a pretty dataframe.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Get intervals</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Separate nodes</span>
</span></span><span style="display:flex;"><span><span style="color:#000">int_nodes</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">getNodeSet</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dat</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;//samples//samples&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># For each node, get children as list</span>
</span></span><span style="display:flex;"><span><span style="color:#000">int_list</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">lapply</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">seq_len</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">xmlSize</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">int_nodes</span><span style="color:#000;font-weight:bold">)),</span> <span style="color:#204a87;font-weight:bold">function</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">as.list</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">getChildrenStrings</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">int_nodes[[x]]</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Process intervals</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># summ_list$samples[[1]]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">int_df</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">bind_rows</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">lapply</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">int_list</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">function</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">data.frame</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;int_id&#34;</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">id</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;id&#34;</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">workoutId</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;elevation&#34;</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">as.numeric</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">elevation</span><span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;latitude&#34;</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">as.numeric</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">lat</span><span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;longitude&#34;</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">as.numeric</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">lon</span><span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#34;speed&#34;</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">as.numeric</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">speed</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">}))</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">group_by</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">id</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">arrange</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">int_id</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">mutate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">int</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">row_number</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">relocate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">id</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">int</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">dplyr</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">select</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">int_id</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">mutate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">per</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">int</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#000">max</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">int</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Check all interval IDs in summary dataframe</span>
</span></span><span style="display:flex;"><span><span style="color:#000">stopifnot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">all</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sort</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">unique</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">int_df</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">id</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">%in%</span> <span style="color:#000">sort</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">unique</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">summ_df</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">id</span><span style="color:#000;font-weight:bold">))))</span>
</span></span></code></pre></div><p>Then extract a single ride ID, in this case the most recent ride, and create interval plots. The first is a speed plot, and the second is an elevation plot.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Extract most recent ID</span>
</span></span><span style="display:flex;"><span><span style="color:#000">ex_id</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">summ_df</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">id</span><span style="color:#000">[order</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">summ_df</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">start</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">decreasing</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">TRUE</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">][1]</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Create speed plot of a particular ride</span>
</span></span><span style="display:flex;"><span><span style="color:#000">int_speed</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">int_df</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">filter</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">id</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">ex_id</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">ggplot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.,</span> <span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">int</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">speed</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">geom_line</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">theme_bw</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">scale_y_continuous</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">expression</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Speed&#34;</span><span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">km</span><span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000">h^</span><span style="color:#0000cf;font-weight:bold">-1</span><span style="color:#000;font-weight:bold">)),</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">sec.axis</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">sec_axis</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">transform</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000">.*kmt</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">expression</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Speed&#34;</span><span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">miles</span><span style="color:#ce5c00;font-weight:bold">~</span><span style="color:#000">h^</span><span style="color:#0000cf;font-weight:bold">-1</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">xlab</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Interval&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Create elevation plot of a particular ride</span>
</span></span><span style="display:flex;"><span><span style="color:#000">int_elev</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">int_df</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">filter</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">id</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">ex_id</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">ggplot</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.,</span> <span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">int</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">elevation</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">geom_line</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">theme_bw</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">labs</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;Interval&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;Elevation (m)&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Combine speed and elevation plots for a particular ride</span>
</span></span><span style="display:flex;"><span><span style="color:#000">plots_ride</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">int_speed</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">int_elev</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">plot_layout</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ncol</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><figure><a href="/img_full/fitotrack/plots_ride.png"><img
          alt="Plots of single ride generated by code above."
          title="Plots of single ride generated by code above."src="/img/fitotrack/plots_ride.png" 
      /></a></figure>


<p>Finally, create a simple interactive map of the ride.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Create sf object with interval points</span>
</span></span><span style="display:flex;"><span><span style="color:#000">int_sf</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">int_fil</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">st_as_sf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.,</span> <span style="color:#000">coords</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;longitude&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;latitude&#34;</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">crs</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">4326</span><span style="color:#000;font-weight:bold">)</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Duplicate points to get start and end of interval, </span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># add ID, summarise to interval lines</span>
</span></span><span style="display:flex;"><span><span style="color:#000">int_lines</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">int_sf</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">mutate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">int</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">int</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">bind_rows</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.,</span> <span style="color:#000">int_sf</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">arrange</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">int</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">group_by</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">int</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">summarise</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">elevation</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mean</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">elevation</span><span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">speed</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mean</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">speed</span><span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">per</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mean</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">per</span><span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">n</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">(),</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">do_union</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">FALSE</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">filter</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">n</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">st_cast</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.,</span> <span style="color:#4e9a06">&#34;LINESTRING&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Create colour palette</span>
</span></span><span style="display:flex;"><span><span style="color:#000">pal</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">colorNumeric</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">palette</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;plasma&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">domain</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">int_lines</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">speed</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Create leaflet map call</span>
</span></span><span style="display:flex;"><span><span style="color:#000">lmap</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">leaflet</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">addTiles</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">setView</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">lng</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mean</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">int_fil</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">longitude</span><span style="color:#000;font-weight:bold">),</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">lat</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mean</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">int_fil</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">latitude</span><span style="color:#000;font-weight:bold">),</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">zoom</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">12</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">addPolylines</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">int_lines</span><span style="color:#000;font-weight:bold">,</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">color</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">pal</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">int_lines</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">speed</span><span style="color:#000;font-weight:bold">),</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">opacity</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><figure><a href="/img_full/fitotrack/leaflet.png"><img
          alt="Screenshot of leaflet map showing route with colouring by speed."
          title="Screenshot of leaflet map showing route with colouring by speed."src="/img/fitotrack/leaflet.png" 
      /></a></figure>


<h2 id="update-2024-07-02">Update 2024-07-02</h2>
<p>I recently added a kind of heatmap that plots all my rides using leaflet. It uses the <a href="https://github.com/r-spatial/leafgl" target="_blank">leafgl</a>
 package to efficiently render many line segments using webGL. For ~140,000 line segments it took about 5 seconds to load the map and the map is pretty snappy in the browser once it is rendered.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#000">int_all_sf</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">int_all</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">st_as_sf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.,</span> <span style="color:#000">coords</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;longitude&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;latitude&#34;</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">crs</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">4326</span><span style="color:#000;font-weight:bold">)</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Duplicate points to get start and end of interval, </span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># add ID, summarise to interval lines</span>
</span></span><span style="display:flex;"><span><span style="color:#000">int_all_lines</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">int_all_sf</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">mutate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">int</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">int</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">bind_rows</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.,</span> <span style="color:#000">int_all_sf</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">arrange</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">int</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">group_by</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">id</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">int</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">summarise</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">elevation</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mean</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">elevation</span><span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">speed</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mean</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">speed</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#ce5c00;font-weight:bold">/</span><span style="color:#000">kmt</span><span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">per</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mean</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">per</span><span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">n</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">n</span><span style="color:#000;font-weight:bold">(),</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">do_union</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">FALSE</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">.groups</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;keep&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">filter</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">n</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">st_cast</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">.,</span> <span style="color:#4e9a06">&#34;LINESTRING&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Create leaflet heatmap of all rides</span>
</span></span><span style="display:flex;"><span><span style="color:#000">heatmap_all</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">leaflet</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">options</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">leafletOptions</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">perferCanvas</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">TRUE</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">addTiles</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">setView</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">lng</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mean</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">int_all</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">longitude</span><span style="color:#000;font-weight:bold">),</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">lat</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">mean</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">int_all</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">latitude</span><span style="color:#000;font-weight:bold">),</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">zoom</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">12</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#000">addGlPolylines</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">int_all_lines</span><span style="color:#000;font-weight:bold">,</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">color</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;#0000ff&#34;</span><span style="color:#000;font-weight:bold">,</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">opacity</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0.05</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">src</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">TRUE</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">digits</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">5</span><span style="color:#000;font-weight:bold">)</span> 
</span></span></code></pre></div><figure><a href="/img_full/fitotrack/heatmap.png"><img
          alt="Screenshot of leaflet heatmap."
          title="Screenshot of leaflet heatmap."src="/img/fitotrack/heatmap.png" 
      /></a></figure>



</main>

  <footer>
  <hr/>
  John L. Godlee | 
  <a href="mailto:johngodlee@gmail.com">johngodlee@gmail.com</a> |
  <a href="http://johngodlee.xyz//index.xml">RSS</a>

  </footer>
  </body>
</html>

