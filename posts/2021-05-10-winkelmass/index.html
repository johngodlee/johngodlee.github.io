<!DOCTYPE html>
<html lang="en-gb">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>John L. Godlee</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">John L. Godlee</a></li>
      
      <li><a href="/cv">CV</a></li>
      
      <li><a href="/works">Works</a></li>
      
    </ul>
    <hr/>
    </nav>


<div>
<h1>Calculating the winkelmass in R</h1>

<h2>2021-05-10</h2>
</div>

<main>
<p>Winkelmass means &ldquo;angle measure&rdquo; in German. In forestry the term has been adopted to refer to a specific metric used to describe the regularity of tree spatial distribution. Literature on the winkelmass traces mostly to Klaus von Gadow, a researcher split between the University of GÃ¶ttingen and Beijing Forestry University. The winkelmass is quite simple at it&rsquo;s core. For each tree, a given number of nearest neighbours are identified, usually four. Then, going clockwise around the focal tree, the angle between each neighbour and the next neighbour is calculated. For each angle, if the angle is less than the &lsquo;critical angle&rsquo; i.e. 360 degrees divided by the number of neighbours considered, a value of 1 is recorded, otherwise, a value of 0 is recorded. Finally, the sum of these values divided by the number of neighbours gives the winkelmass. In LaTeX math:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-tex" data-lang="tex">W<span style="color:#204a87">_{</span>i<span style="color:#204a87">}</span> = <span style="color:#204a87;font-weight:bold">\frac</span><span style="color:#204a87">{</span>1<span style="color:#204a87">}{</span>k<span style="color:#204a87">}</span> <span style="color:#204a87;font-weight:bold">\sum</span><span style="color:#204a87">_{</span>j=1<span style="color:#204a87">}^{</span>k<span style="color:#204a87">}</span> v<span style="color:#204a87">_{</span>j<span style="color:#204a87">}</span>
</code></pre></div><p>where <code>W</code> is the winkelmass, <code>k</code> is the number of neighbours considered, and <code>v_{j}</code> is either 0 or 1 depending on the angle between two neighbours.</p>
<p>To calculate the plot-level winkelmass, simply take the mean of all <code>W_{i}</code> values in the plot.</p>
<p>I wrote a function in R to calculate the Winkelmass for all trees in a plot:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#8f5902;font-style:italic">#&#39; Winkelmass (spatial regularity of trees)</span>
<span style="color:#8f5902;font-style:italic">#&#39;</span>
<span style="color:#8f5902;font-style:italic">#&#39; @param x vector of individual x axis coordinates</span>
<span style="color:#8f5902;font-style:italic">#&#39; @param y vector of individual y axis coordinates</span>
<span style="color:#8f5902;font-style:italic">#&#39; @param k number of neighbours to consider</span>
<span style="color:#8f5902;font-style:italic">#&#39;</span>
<span style="color:#8f5902;font-style:italic">#&#39; @references von Gadow, K., Hui, G. Y. (2001). Characterising forest spatial </span>
<span style="color:#8f5902;font-style:italic">#&#39; structure and diversity. Sustainable Forestry in Temperate Regions. Proc. of </span>
<span style="color:#8f5902;font-style:italic">#&#39; an international workshop organized at the University of Lund, Sweden. </span>
<span style="color:#8f5902;font-style:italic">#&#39; Pages 20- 30.</span>
<span style="color:#8f5902;font-style:italic">#&#39; </span>
<span style="color:#000">winkelmass</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">function</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">k</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">4</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
  <span style="color:#000">dat_sf</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">sf</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">st_as_sf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data.frame</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">y</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">coords</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;x&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;y&#34;</span><span style="color:#000;font-weight:bold">))</span>

  <span style="color:#000">dists</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">suppressMessages</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">nngeo</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">st_nn</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dat_sf</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dat_sf</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">k</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">k</span><span style="color:#0000cf;font-weight:bold">+1</span><span style="color:#000;font-weight:bold">,</span> 
      <span style="color:#000">progress</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">FALSE</span><span style="color:#000;font-weight:bold">))</span>

  <span style="color:#000">a0</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#0000cf;font-weight:bold">360</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#000">k</span>

  <span style="color:#000">wi</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">unlist</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">lapply</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dists</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">function</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">i</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000">focal_sfg</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">sf</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">st_geometry</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dat_sf[i[1]</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">]</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">[[1]]</span>
    <span style="color:#000">nb_sfg</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">sf</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">st_geometry</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dat_sf[i[</span><span style="color:#0000cf;font-weight:bold">-1</span><span style="color:#000">]</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000">]</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">nb_angles</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">sort</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">unlist</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">lapply</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">nb_sfg</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">function</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">j</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
      <span style="color:#000">angleCalc</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">focal_sfg</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">j</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000;font-weight:bold">})))</span>
  
    <span style="color:#000">aj</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">nb_angles</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">NA</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">head</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">nb_angles</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">-1</span><span style="color:#000;font-weight:bold">))</span>
    <span style="color:#000">aj[1]</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">nb_angles[k]</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">nb_angles[1]</span>
    <span style="color:#000">aj</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">ifelse</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">aj</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#0000cf;font-weight:bold">180</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">360</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">aj</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">aj</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">aj</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">round</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">aj</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#000">sum</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">aj</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">a0</span><span style="color:#000;font-weight:bold">)</span>
  <span style="color:#000;font-weight:bold">}))</span>

  <span style="color:#000">out</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#000">k</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">wi</span>

  <span style="color:#000">return</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">out</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>The function uses <code>{nngeo}</code> to find nearest neighbours of each tree by their x and y grid coordinates. Then it makes <code>{sf}</code> geometry objects and calculates the angles between them, and finally does a bit of arithmetic to find if the angles are less than the critical angle. An important aspect to the calculation is that if the angle between two neighbours is greater than 180 degrees, the opposite angle is taken. So if an angle is 275 degrees, the recorded angle is 360 - 275 = 85 degrees. In this example by taking the opposite angle the value of <code>v_{j}</code> changes from 0 (275 gt 90) to 1 (85 lt 90).</p>
<p>The <code>angleCalc()</code> function is:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#8f5902;font-style:italic">#&#39; Calculate angle between two sf point objects</span>
<span style="color:#8f5902;font-style:italic">#&#39;</span>
<span style="color:#8f5902;font-style:italic">#&#39; @param x point feature of class &#39;sf&#39;</span>
<span style="color:#8f5902;font-style:italic">#&#39; @param y point feature of class &#39;sf&#39;</span>
<span style="color:#8f5902;font-style:italic">#&#39;</span>
<span style="color:#8f5902;font-style:italic">#&#39; @return azimuthal from x to y, in degrees</span>
<span style="color:#8f5902;font-style:italic">#&#39; </span>
<span style="color:#8f5902;font-style:italic">#&#39; @examples</span>
<span style="color:#8f5902;font-style:italic">#&#39; p1 &lt;- st_point(c(0,1))</span>
<span style="color:#8f5902;font-style:italic">#&#39; p2 &lt;- st_point(c(1,2))</span>
<span style="color:#8f5902;font-style:italic">#&#39; angleCalc(p1, p2)</span>
<span style="color:#8f5902;font-style:italic">#&#39; </span>
<span style="color:#8f5902;font-style:italic">#&#39; @export</span>
<span style="color:#8f5902;font-style:italic">#&#39; </span>
<span style="color:#000">angleCalc</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">function</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
  <span style="color:#000">dst_diff</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">as.numeric</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">y</span><span style="color:#000;font-weight:bold">)</span>
  <span style="color:#000">return</span><span style="color:#000;font-weight:bold">((</span><span style="color:#000">atan2</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dst_diff[1]</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">dst_diff[2]</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#204a87;font-weight:bold">pi</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">/</span> <span style="color:#0000cf;font-weight:bold">0.01745329</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>I also wrote some tests for the function to make sure it worked properly. First, packages, all for visualising results, not needed for calculations:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#000">library</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ggplot2</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">library</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">patchwork</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000">library</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">knitr</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Define a function to create maps to visualise the distribution of neighbours around a focal tree:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#000">linemake</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">function</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dat</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span> 
  <span style="color:#000">out</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">data.frame</span><span style="color:#000;font-weight:bold">(</span>
    <span style="color:#000">xmin</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">rep</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dat</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">x[1]</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">times</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">nrow</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dat</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">),</span> 
    <span style="color:#000">ymin</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">rep</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dat</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">y[1]</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">times</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">nrow</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dat</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">),</span>
    <span style="color:#000">xmax</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">dat</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">x[</span><span style="color:#0000cf;font-weight:bold">-1</span><span style="color:#000">]</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">ymax</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">dat</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">y[</span><span style="color:#0000cf;font-weight:bold">-1</span><span style="color:#000">]</span><span style="color:#000;font-weight:bold">)</span>
  <span style="color:#000">return</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">out</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000;font-weight:bold">}</span>

<span style="color:#000">plotmake</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">function</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dat</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
  <span style="color:#000">lout</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">linemake</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dat</span><span style="color:#000;font-weight:bold">)</span>
  <span style="color:#000">dat</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">label</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;F&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;1&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;2&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;3&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;4&#34;</span><span style="color:#000;font-weight:bold">)</span>

  <span style="color:#000">ggplot</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
    <span style="color:#000">geom_segment</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">lout</span><span style="color:#000;font-weight:bold">,</span> 
    	<span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">xmin</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">ymin</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">xend</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">xmax</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">yend</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">ymax</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
    <span style="color:#000">geom_label</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">data</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">dat</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">aes</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">y</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">label</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">label</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">+</span>
    <span style="color:#000">coord_equal</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
    <span style="color:#000">theme_classic</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
    <span style="color:#000">labs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;X&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;Y&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>Create a number of test cases with different spatial distributions of neighbours. Each test case should produce a different value of <code>Wi</code> for the focal tree.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#000">test_list</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">list</span><span style="color:#000;font-weight:bold">(</span>
	<span style="color:#000">test1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">data.frame</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">-1</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">-1</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)),</span>
	<span style="color:#000">test2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">data.frame</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">-0.5</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">-1</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0.5</span><span style="color:#000;font-weight:bold">)),</span>
	<span style="color:#000">test3</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">data.frame</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0.5</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">-0.5</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0.5</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">-1</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0.5</span><span style="color:#000;font-weight:bold">)),</span>
	<span style="color:#000">test4</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">data.frame</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0.2</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">-0.4</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">-0.5</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0.5</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">-0.1</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0.5</span><span style="color:#000;font-weight:bold">)),</span>
	<span style="color:#000">test5</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">data.frame</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0.2</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">-0.5</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">-0.2</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">c</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0.9</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0.4</span><span style="color:#000;font-weight:bold">,</span><span style="color:#0000cf;font-weight:bold">0.5</span><span style="color:#000;font-weight:bold">))</span>
	<span style="color:#000;font-weight:bold">)</span>
</code></pre></div><p>Create the maps to visualise layout of the test cases:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#000">plot_list</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">lapply</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">test_list</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">plotmake</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">wrap_plots</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">plot_list</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">+</span> 
	<span style="color:#000">plot_layout</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">nrow</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><figure><a href="/img_full/winkelmass/layout.png"><img
          alt="Simulated tree layouts"
          title="Simulated tree layouts"src="/img/winkelmass/layout.png" 
      /></a></figure>


<p>Finally run the <code>winkelmass()</code> function and extract the first value which refers to the focal tree:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#000">kable</span><span style="color:#000;font-weight:bold">(</span>
	<span style="color:#000">unlist</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">lapply</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">test_list</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">function</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
		<span style="color:#000">winkelmass</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">x</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">$</span><span style="color:#000">y</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000">[1]</span>
	<span style="color:#000;font-weight:bold">})))</span>
</code></pre></div><table>
<thead>
<tr>
<th>Ex</th>
<th>Wi</th>
</tr>
</thead>
<tbody>
<tr>
<td>test1</td>
<td>0.00</td>
</tr>
<tr>
<td>test2</td>
<td>0.25</td>
</tr>
<tr>
<td>test3</td>
<td>0.50</td>
</tr>
<tr>
<td>test4</td>
<td>0.75</td>
</tr>
<tr>
<td>test5</td>
<td>1.00</td>
</tr>
</tbody>
</table>
<p>As you can see, for a given value of <code>k</code>, there are <code>k+1</code> possible values of <code>Wi</code> depending on the distribution of neighbours.</p>

</main>

  <footer>
  <hr/>
  John L. Godlee | 
  <a href="mailto:johngodlee@gmail.com">johngodlee@gmail.com</a> |
  <a href="http://johngodlee.xyz//index.xml">RSS</a>

  </footer>
  </body>
</html>

